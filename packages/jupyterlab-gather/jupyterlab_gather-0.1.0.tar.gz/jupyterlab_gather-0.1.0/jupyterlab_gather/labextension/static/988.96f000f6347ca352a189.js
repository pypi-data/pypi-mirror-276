"use strict";(self.webpackChunkjupyterlab_gather=self.webpackChunkjupyterlab_gather||[]).push([[988],{6641:(e,t,n)=>{n.r(t),n.d(t,{IGatherRegistryToken:()=>m,default:()=>ie});var a=n(1201),s=n(3420),o=n(8107),i=n(1218),r=n(4814),l=n(1760);const c=new l.LabIcon({name:"jupyterlab-gather:icon_logo",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   width="512"\n   height="512"\n   version="1.1"\n   viewBox="0 0 384 384"\n   id="svg106"\n   sodipodi:docname="duckduck.svg"\n   inkscape:version="1.2.2 (b0a8486541, 2022-12-01)"\n   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"\n   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:svg="http://www.w3.org/2000/svg">\n  <sodipodi:namedview\n     id="namedview108"\n     pagecolor="#505050"\n     bordercolor="#ffffff"\n     borderopacity="1"\n     inkscape:showpageshadow="0"\n     inkscape:pageopacity="0"\n     inkscape:pagecheckerboard="1"\n     inkscape:deskcolor="#505050"\n     showgrid="true"\n     inkscape:zoom="1.4580864"\n     inkscape:cx="293.19251"\n     inkscape:cy="208.14954"\n     inkscape:window-width="2880"\n     inkscape:window-height="1653"\n     inkscape:window-x="0"\n     inkscape:window-y="56"\n     inkscape:window-maximized="1"\n     inkscape:current-layer="svg106">\n    <inkscape:grid\n       type="xygrid"\n       id="grid1742"\n       dotted="true"\n       spacingx="7.5"\n       spacingy="7.5"\n       empcolor="#d2c538"\n       empopacity="0.83921569"\n       color="#7fa342"\n       opacity="0.14901961" />\n  </sodipodi:namedview>\n  <defs\n     id="defs26">\n    <inkscape:path-effect\n       effect="bspline"\n       id="path-effect2594"\n       is_visible="true"\n       lpeversion="1"\n       weight="33.333333"\n       steps="2"\n       helper_size="0"\n       apply_no_weight="true"\n       apply_with_weight="true"\n       only_selected="false" />\n    <inkscape:path-effect\n       effect="bspline"\n       id="path-effect2587"\n       is_visible="true"\n       lpeversion="1"\n       weight="33.333333"\n       steps="2"\n       helper_size="0"\n       apply_no_weight="true"\n       apply_with_weight="true"\n       only_selected="false" />\n    <inkscape:path-effect\n       effect="bspline"\n       id="path-effect2511"\n       is_visible="true"\n       lpeversion="1"\n       weight="33.333333"\n       steps="2"\n       helper_size="0"\n       apply_no_weight="true"\n       apply_with_weight="true"\n       only_selected="false" />\n    <inkscape:perspective\n       sodipodi:type="inkscape:persp3d"\n       inkscape:vp_x="-44.677687 : 70.826469 : 1"\n       inkscape:vp_y="0 : 683.64079 : 0"\n       inkscape:vp_z="625.53854 : 70.826469 : 1"\n       inkscape:persp3d-origin="290.43042 : 27.073459 : 1"\n       id="perspective341" />\n    <clipPath\n       id="clipPath4">\n      <rect\n         width="384"\n         height="384"\n         id="rect2" />\n    </clipPath>\n    <clipPath\n       id="clipPath8">\n      <rect\n         width="384"\n         height="384"\n         id="rect6" />\n    </clipPath>\n    <clipPath\n       id="clipPath12">\n      <rect\n         width="384"\n         height="384"\n         id="rect10" />\n    </clipPath>\n    <clipPath\n       id="clipPath16">\n      <rect\n         width="384"\n         height="384"\n         id="rect14" />\n    </clipPath>\n    <clipPath\n       id="clipPath20">\n      <rect\n         width="384"\n         height="384"\n         id="rect18" />\n    </clipPath>\n    <clipPath\n       id="clipPath24">\n      <rect\n         width="384"\n         height="384"\n         id="rect22" />\n    </clipPath>\n    <inkscape:path-effect\n       effect="bspline"\n       id="path-effect2511-3"\n       is_visible="true"\n       lpeversion="1"\n       weight="33.333333"\n       steps="2"\n       helper_size="0"\n       apply_no_weight="true"\n       apply_with_weight="true"\n       only_selected="false" />\n    <inkscape:path-effect\n       effect="bspline"\n       id="path-effect2594-3"\n       is_visible="true"\n       lpeversion="1"\n       weight="33.333333"\n       steps="2"\n       helper_size="0"\n       apply_no_weight="true"\n       apply_with_weight="true"\n       only_selected="false" />\n    <inkscape:path-effect\n       effect="bspline"\n       id="path-effect2511-3-5"\n       is_visible="true"\n       lpeversion="1"\n       weight="33.333333"\n       steps="2"\n       helper_size="0"\n       apply_no_weight="true"\n       apply_with_weight="true"\n       only_selected="false" />\n    <inkscape:path-effect\n       effect="bspline"\n       id="path-effect2511-3-9"\n       is_visible="true"\n       lpeversion="1"\n       weight="33.333333"\n       steps="2"\n       helper_size="0"\n       apply_no_weight="true"\n       apply_with_weight="true"\n       only_selected="false" />\n    <inkscape:path-effect\n       effect="bspline"\n       id="path-effect2511-3-6"\n       is_visible="true"\n       lpeversion="1"\n       weight="33.333333"\n       steps="2"\n       helper_size="0"\n       apply_no_weight="true"\n       apply_with_weight="true"\n       only_selected="false" />\n    <inkscape:path-effect\n       effect="bspline"\n       id="path-effect2511-3-62"\n       is_visible="true"\n       lpeversion="1"\n       weight="33.333333"\n       steps="2"\n       helper_size="0"\n       apply_no_weight="true"\n       apply_with_weight="true"\n       only_selected="false" />\n    <inkscape:path-effect\n       effect="bspline"\n       id="path-effect2594-2"\n       is_visible="true"\n       lpeversion="1"\n       weight="33.333333"\n       steps="2"\n       helper_size="0"\n       apply_no_weight="true"\n       apply_with_weight="true"\n       only_selected="false" />\n    <inkscape:path-effect\n       effect="bspline"\n       id="path-effect2594-23"\n       is_visible="true"\n       lpeversion="1"\n       weight="33.333333"\n       steps="2"\n       helper_size="0"\n       apply_no_weight="true"\n       apply_with_weight="true"\n       only_selected="false" />\n    <inkscape:path-effect\n       effect="bspline"\n       id="path-effect2594-5"\n       is_visible="true"\n       lpeversion="1"\n       weight="33.333333"\n       steps="2"\n       helper_size="0"\n       apply_no_weight="true"\n       apply_with_weight="true"\n       only_selected="false" />\n  </defs>\n  <g\n     inkscape:groupmode="layer"\n     id="layer1"\n     inkscape:label="water"\n     style="display:inline" />\n  <g\n     inkscape:groupmode="layer"\n     id="layer8"\n     inkscape:label="duck" />\n  <g\n     inkscape:groupmode="layer"\n     id="layer3"\n     inkscape:label="duckBody"\n     style="display:inline" />\n  <g\n     inkscape:groupmode="layer"\n     id="layer4"\n     inkscape:label="duckLeftWing"\n     style="display:inline" />\n  <g\n     inkscape:groupmode="layer"\n     id="layer5"\n     inkscape:label="duckRightWing" />\n  <g\n     inkscape:groupmode="layer"\n     id="layer2"\n     inkscape:label="duckHead"\n     style="fill:#ffd631;fill-opacity:1" />\n  <g\n     inkscape:groupmode="layer"\n     id="layer6"\n     inkscape:label="duckBeak" />\n  <g\n     inkscape:groupmode="layer"\n     id="layer7"\n     inkscape:label="duckEye" />\n  <g\n     id="g3440"\n     transform="translate(2.99995,-16.741492)">\n    <path\n       style="display:inline;fill:#2eeeff;fill-opacity:1;stroke:#1b98ae;stroke-width:4.2;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       d="m 9.00005,111.24148 v 225 l 150,-75 v -225 l -150,75"\n       id="path2328" />\n    <path\n       style="display:inline;fill:#20c9db;fill-opacity:1;stroke:#20aec3;stroke-width:4.2;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       d="m 159.00005,261.24148 210,45 v -225 l -210,-45 v 225"\n       id="path2330"\n       sodipodi:nodetypes="ccccc" />\n    <path\n       style="display:inline;fill:#009bb3;fill-opacity:1;stroke:#126d85;stroke-width:4.2;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       d="m 9.00005,336.24148 210,45 150,-75 -210,-45 -150,75"\n       id="path2332"\n       sodipodi:nodetypes="ccccc" />\n    <path\n       id="path2442-6"\n       style="display:inline;fill:#ffb943;fill-opacity:1;stroke:#480400;stroke-width:4.2;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       d="m 181.50005,171.24148 a 123.75,78.75 0 0 0 -123.75,78.75 123.75,78.75 0 0 0 123.75,78.75 123.75,78.75 0 0 0 123.75,-78.75 123.75,78.75 0 0 0 -0.39844,-6.2959 c 3.71787,-21.18852 5.18003,-40.34448 -3.97705,-49.92187 -8.66762,-9.06547 -26.8456,-9.5528 -47.44922,-7.85303 a 123.75,78.75 0 0 0 -71.92529,-14.6792 z" />\n    <path\n       id="path2442-6-2"\n       style="display:inline;fill:#fb9200;fill-opacity:1;stroke:none;stroke-width:4.2;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       d="m 63.48931,226.64334 a 123.75,78.75 0 0 0 -5.73926,23.34814 123.75,78.75 0 0 0 123.75,78.75 123.75,78.75 0 0 0 123.03809,-70.67871 123.75,78.75 0 0 1 -118.01075,55.40332 123.75,78.75 0 0 1 -123.75,-78.75 123.75,78.75 0 0 1 0.71192,-8.07275 z" />\n    <path\n       id="path2442-6-0"\n       style="display:inline;fill:none;fill-opacity:1;stroke:#480400;stroke-width:4.2;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       d="m 181.50005,171.24148 a 123.75,78.75 0 0 0 -123.75,78.75 123.75,78.75 0 0 0 123.75,78.75 123.75,78.75 0 0 0 123.75,-78.75 123.75,78.75 0 0 0 -0.39844,-6.2959 c 3.71787,-21.18852 5.18003,-40.34448 -3.97705,-49.92187 -8.66762,-9.06547 -26.8456,-9.5528 -47.44922,-7.85303 a 123.75,78.75 0 0 0 -71.92529,-14.6792 z" />\n    <path\n       style="display:inline;fill:#ffb943;fill-opacity:1;stroke:#480400;stroke-width:4.2;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       d="m 222.75018,203.74104 c 19.99996,-22.49995 39.99996,-44.99995 48.74993,-41.24934 8.74996,3.75062 6.25001,33.75002 -6e-5,53.74978 -6.25007,19.99976 -16.24987,29.99956 -26.24987,39.99956"\n       id="path2509"\n       inkscape:path-effect="#path-effect2511-3"\n       inkscape:original-d="m 222.75018,203.74104 c 20.00075,-22.49925 40.00075,-44.99925 60,-67.5 -2.4993,30.00135 -4.99925,60.00075 -7.5,90 -9.99945,10.00095 -19.99925,20.00075 -30,30" />\n    <path\n       id="path2509-3"\n       style="display:inline;fill:#fb9200;fill-opacity:1;stroke:none;stroke-width:4.2;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       d="m 275.2163,182.06104 c -1.16258,6.97806 -2.79543,13.93413 -4.7622,20.06689 C 263.194,224.76623 251.61574,236.17987 240,247.5 l 3.33984,7.79297 c 9.99999,-9.99999 19.99994,-19.99928 26.25,-39.99902 3.15213,-10.08659 5.34413,-22.70937 5.62646,-33.23291 z" />\n    <path\n       style="display:inline;fill:none;fill-opacity:1;stroke:#480400;stroke-width:4.2;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       d="m 222.75018,203.74104 c 19.99996,-22.49995 39.99996,-44.99995 48.74993,-41.24934 8.74996,3.75062 6.25001,33.75002 -6e-5,53.74978 -6.25007,19.99976 -16.24987,29.99956 -26.24987,39.99956"\n       id="path2509-0"\n       inkscape:path-effect="#path-effect2511-3-6"\n       inkscape:original-d="m 222.75018,203.74104 c 20.00075,-22.49925 40.00075,-44.99925 60,-67.5 -2.4993,30.00135 -4.99925,60.00075 -7.5,90 -9.99945,10.00095 -19.99925,20.00075 -30,30" />\n    <ellipse\n       style="fill:#ffb943;fill-opacity:1;stroke:#480400;stroke-width:4.2;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       id="path2387"\n       cx="132.78143"\n       cy="173.38272"\n       rx="63.75"\n       ry="60" />\n    <path\n       id="path2387-1"\n       style="fill:#fb9200;fill-opacity:1;stroke:none;stroke-width:4.2;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       d="m 69.847354,182.49404 a 63.75,60 0 0 0 62.934076,50.88867 63.75,60 0 0 0 62.93408,-50.88867 71.25,67.5 0 0 1 -62.93408,35.88867 71.25,67.5 0 0 1 -62.934076,-35.88867 z" />\n    <ellipse\n       style="fill:none;fill-opacity:1;stroke:#480400;stroke-width:4.2;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       id="path2387-7"\n       cx="132.78143"\n       cy="173.38272"\n       rx="63.75"\n       ry="60" />\n    <path\n       style="fill:#ff7080;fill-opacity:1;stroke:#480400;stroke-width:4.2;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       d="m 83.646319,167.32763 c 5.903416,-2.86002 11.127279,-7.22724 15.453442,-6.46901 4.326159,0.75822 7.753739,6.64086 11.181669,12.52409 15.26394,6.19638 30.52675,12.3923 28.03672,18.11905 -2.49003,5.72675 -22.73208,10.98424 -47.694921,9.25175 -24.962846,-1.73249 -54.645191,-10.45491 -59.95035,-16.22697 -5.305159,-5.77206 12.932616,-8.46988 26.709781,-10.728 13.777164,-2.25812 20.360242,-3.61089 26.263659,-6.47091 z"\n       id="path2592"\n       inkscape:path-effect="#path-effect2594"\n       inkscape:original-d="m 84.32576,168.83492 c 5.22441,-4.36679 10.44827,-8.73401 15.67189,-13.1019 3.42828,5.88382 10.28378,17.64969 10.28378,17.64969 15.26378,6.19676 30.52659,12.39269 45.78938,18.58814 -20.24253,5.25829 -40.48457,10.51579 -60.72737,15.7728 -29.683186,-8.72219 -59.365533,-17.4446 -89.048813,-26.16778 19.073184,-2.82077 37.002612,-7.60308 57.217365,-8.46388 8.080918,0.53598 14.447518,-1.87025 20.813768,-4.27707 z"\n       sodipodi:nodetypes="czcccccc" />\n    <path\n       id="path2592-7"\n       style="fill:#f9005a;fill-opacity:0.828653;stroke:none;stroke-width:4.2;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       d="m 31.442794,179.73198 c -1.67491,1.20871 -2.08707,2.60472 -0.57129,4.25391 5.30516,5.77206 34.98737,14.49505 59.950196,16.22754 24.96282,1.73249 45.20528,-3.52521 47.69531,-9.25195 0.62544,-1.43843 0.12773,-2.9058 -1.20556,-4.396 -9.28186,4.6367 -27.61372,7.79812 -48.93604,6.20361 -20.144896,-1.50645 -42.917586,-7.25686 -56.932616,-13.03711 z" />\n    <path\n       style="fill:none;fill-opacity:1;stroke:#480400;stroke-width:4.2;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       d="m 83.646319,167.32763 c 5.903416,-2.86002 11.127279,-7.22724 15.453442,-6.46901 4.326159,0.75822 7.753739,6.64086 11.181669,12.52409 15.26394,6.19638 30.52675,12.3923 28.03672,18.11905 -2.49003,5.72675 -22.73208,10.98424 -47.694922,9.25175 -24.962847,-1.73249 -54.645191,-10.45491 -59.950348,-16.22697 -5.305156,-5.77206 12.932611,-8.46988 26.709778,-10.728 13.777166,-2.25812 20.360244,-3.61089 26.263661,-6.47091 z"\n       id="path2592-9"\n       inkscape:path-effect="#path-effect2594-5"\n       inkscape:original-d="m 84.32576,168.83492 c 5.22441,-4.36679 10.44827,-8.73401 15.67189,-13.1019 3.42828,5.88382 10.28378,17.64969 10.28378,17.64969 15.26378,6.19676 30.52659,12.39269 45.78938,18.58814 -20.24253,5.25829 -40.48457,10.51579 -60.72737,15.7728 -29.683188,-8.72219 -59.365535,-17.4446 -89.048815,-26.16778 19.07319,-2.82077 37.00261,-7.60308 57.217367,-8.46388 8.080918,0.53598 14.447518,-1.87025 20.813768,-4.27707 z"\n       sodipodi:nodetypes="czcccccc" />\n    <ellipse\n       style="fill:#fb9200;fill-opacity:1;stroke:none;stroke-width:4.20001;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       id="path2684-9"\n       cx="156.99413"\n       cy="175.19801"\n       rx="11.849189"\n       ry="11.433258" />\n    <ellipse\n       style="fill:#2f0300;fill-opacity:1;stroke:none;stroke-width:4.20001;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       id="path2684"\n       cx="156.67303"\n       cy="173.78844"\n       rx="11.25"\n       ry="9.8404236" />\n    <circle\n       style="fill:#fbc892;fill-opacity:0.464482;stroke:none;stroke-width:4.2;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       id="path2686"\n       cx="160.08458"\n       cy="170.52603"\n       r="3.75" />\n    <path\n       id="path1752"\n       style="display:inline;fill:none;fill-opacity:1;stroke:#08415c;stroke-width:9;stroke-linecap:round;stroke-linejoin:round;stroke-dasharray:none;stroke-opacity:1"\n       d="m 219.00005,156.24148 150,-75 m -360,30 150,-75 210,45 v 225 l -150,75 m -210,-270 v 225 l 210,45 v -225 l -210,-45"\n       inkscape:label="cubeFrame"\n       sodipodi:nodetypes="cccccccccccc" />\n  </g>\n</svg>\n'}),d=new l.LabIcon({name:"jupyterlab-ar::ar",svgstr:'<svg height="24px" viewBox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg">\n  <g class="jp-icon3" fill="#616161" id="g2">\n    <path\n       id="path1"\n       style="fill:none;stroke:var(--jp-inverse-layout-color3);stroke-width:1.32718;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10"\n       class="st0"\n       d="m 12.202615,6.6279902 v 4.6175148 m 0,-8.5753842 -4.0053702,1.978935 4.0053702,1.9789349 4.00537,-1.9789349 z m -4.0053702,1.978935 v 4.6175147 l 4.0053702,1.9789345 4.00537,-1.9789345 V 4.6490558" />\n    <path\n       id="path2"\n       style="fill:none;stroke:var(--jp-inverse-layout-color3);stroke-width:1.32718;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;stroke-opacity:1"\n       class="st0"\n       d="M 20.547136,16.786523 17.943645,13.686191 C 17.67662,13.356369 17.342839,13.22444 16.942302,13.22444 H 7.462927 c -0.400537,0 -0.801074,0.197893 -1.0013425,0.461751 L 3.858094,16.786523 c -0.2002684,0.263858 -0.3337808,0.59368 -0.3337808,0.857538 v 1.517184 c 0,0.725609 0.6008055,1.31929 1.3351233,1.31929 H 19.545793 c 0.734318,0 1.335124,-0.593681 1.335124,-1.31929 v -1.517184 c 0,-0.263858 -0.133513,-0.59368 -0.333781,-0.857538 z M 4.191875,17.18231 h 16.021481" />\n  </g>\n</svg>\n'});var p=n(7262),h=n(4602);const m=new p.Token("jupyter.extensions.jupyterlab_gather_plugin");class u{constructor(){this.modelRegistry=new Map,this.modelRegistryChanged=new h.Signal(this)}registerModel(e){const t={...e,name:e.name.toLocaleLowerCase()};this.modelRegistry.set(t.name,e),this.modelRegistryChanged.emit(t)}}var g=n(5694),b=n(8333),y=n(3365),f=n(5256),k=n(3345),w=n.n(k);const v=({model:e,handleClick:t,className:n})=>w().createElement(l.Button,{minimal:!0,className:`${n} jlab-gather-model-list-item`,onClick:()=>t(e)},e.name);var S=n(9707);const E=({children:e,title:t,isOpen:n,hasCloseBtn:a,onClose:s})=>{const[o,i]=(0,k.useState)(n),r=(0,k.useRef)(null);(0,k.useEffect)((()=>{i(n)}),[n]),(0,k.useEffect)((()=>{const e=r.current;e&&(o?(e.showModal(),e.addEventListener("mousedown",l)):(e.removeEventListener("mousedown",l),e.close()))}),[o]);const l=e=>{e.target===e.currentTarget&&c()},c=()=>{s&&s(),i(!1)};return w().createElement("dialog",{ref:r,onKeyDown:e=>{"Escape"===e.key&&c()},className:"jlab-gather-modal"},w().createElement("div",{className:"jlab-gather-modal-content"},w().createElement("div",{className:"jlab-gather-modal-header"},w().createElement("div",{className:"jlab-gather-modal-title"},t),a&&w().createElement("button",{className:"jlab-gather-btn-common jlab-gather-btn-danger jlab-gather-modal-close-btn",onClick:c},"Close")),e))},j=({onSubmit:e,isOpen:t,onClose:n})=>{const a=(0,k.useRef)(null),s=(0,S.uniqueNamesGenerator)({dictionaries:[S.adjectives,S.animals],style:"capital",separator:" "}),[o,i]=(0,k.useState)({name:s,url:""});(0,k.useEffect)((()=>{t&&a.current&&setTimeout((()=>{a.current.focus()}),0)}),[t]);const r=e=>{const{name:t,value:n}=e.target;i((e=>({...e,[t]:n})))};return w().createElement(E,{title:"Add a New Model",hasCloseBtn:!0,isOpen:t,onClose:n},w().createElement("form",{className:"jlab-gather-form",onSubmit:t=>{t.preventDefault(),e(o),i({name:s,url:""})}},w().createElement("div",{className:"jlab-gather-form-input"},w().createElement("label",{htmlFor:"userName"},"Model Name"),w().createElement("input",{required:!0,className:"jlab-gather-input",name:"name",type:"text",placeholder:"Model Name",value:o.name,onChange:r})),w().createElement("div",{className:"jlab-gather-form-input"},w().createElement("label",{htmlFor:"room-code"},"Model Url"),w().createElement("input",{required:!0,className:"jlab-gather-input",name:"url",type:"text",placeholder:"Model Url",value:o.url,onChange:r})),w().createElement("button",{className:"jlab-gather-btn-common jlab-gather-btn-primary"},"Add Model")))};var C=n(6469);const M=new C.JC,N=g.HMSRoomProvider,_=M.getStore(),A=M.getActions();A.initAppData({canLoadModel:!0,modelRegistry:[],isPresenting:!1,presenterId:"",selectedModel:null,loadedModels:[],isConnecting:!1}),A.setLogLevel(C.JZ.WARN);const I=({modelList:e,modelRegistry:t})=>{const[n,a]=(0,k.useState)(!1),[s,o]=(0,k.useState)(!1),[i,r]=(0,k.useState)(void 0),[c,d]=(0,k.useState)(),[p,h]=(0,k.useState)(!1);(0,k.useEffect)((()=>{r(_.getState((0,g.selectAppData)("arCube"))),_.subscribe(u,(0,g.selectAppData)("canLoadModel")),_.subscribe(m,(0,g.selectAppData)("arCube"))}),[]);const m=()=>{r(_.getState((0,g.selectAppData)("arCube")))},u=()=>{const e=_.getState((0,g.selectAppData)("canLoadModel"));a(!e)},f=e=>{d(e),A.setAppData("selectedModel",e)},S=e=>{i||r(_.getState((0,g.selectAppData)("arCube"))),c?null==i||i.changeModelInScene(e,c.name):console.log("Model must be selected")},E=()=>{h(!1)};return w().createElement("div",{className:"jlab-gather-sidebar-container"},w().createElement("div",{className:"jlab-gather-sidebar-description"},"Select a model from the list below"),w().createElement("div",{className:"jlab-gather-sidebar-list"},e.map((e=>w().createElement(v,{model:e,handleClick:f,className:(null==c?void 0:c.name)===e.name?"jlab-gather-model-list-item-selected":""})))),w().createElement("div",{style:{display:"flex",flexDirection:"column"}},w().createElement("div",{className:"jlab-gather-sidebar-buttons"},w().createElement(l.Button,{className:"jlab-gather-sidebar-button",onClick:()=>S(0)},"Set as first model"),w().createElement(l.Button,{className:"jlab-gather-sidebar-button",onClick:()=>S(1)},"Set as second model")),w().createElement(l.Button,{className:"jlab-gather-sidebar-load-button",onClick:()=>{h(!0)},disabled:n},"Add New Model"),w().createElement(j,{isOpen:p,onSubmit:e=>{t.registerModel(e),E()},onClose:E}),w().createElement(l.Button,{className:"jlab-gather-sidebar-load-button",onClick:()=>{s?null==i||i.disableSecondScene():null==i||i.enableSecondScene(),o(!s)},disabled:n},n?w().createElement(y.FontAwesomeIcon,{icon:b.faSpinner,className:"jlab-gather-spinner"}):s?"Disable Second Model":"Load Second Model")))};class x extends l.SidePanel{constructor(e){super({content:new f.Panel}),this._signal=e.modelRegistryChanged,this.addClass("jlab-gather-sidebar-widget"),this.title.icon=d,this.title.className,this.title.caption="Augmented reality";const t=document.createElement("h2");t.textContent="augmented reality",this.header.addWidget(new f.Widget({node:t}));const n=s.ReactWidget.create(w().createElement(l.UseSignal,{signal:this._signal},(()=>w().createElement(I,{modelList:this._modelList,modelRegistry:e}))));this.content.addWidget(n),this._signal.connect(((e,t)=>{this._modelList=this.addModelToRegistryArray(t),this.updateModel(t.name)}))}addModelToRegistryArray(e){const t=[..._.getState((0,g.selectAppData)("modelRegistry"))];return t.map((e=>e.name)).includes(e.name)?t.forEach(((n,a)=>{n.name===e.name&&(t[a]=e)})):t.push(e),A.setAppData("modelRegistry",t),t}updateModel(e){const t=_.getState((0,g.selectAppData)("loadedModels")),n=_.getState((0,g.selectAppData)("arCube")),a=t.findIndex((t=>t===e));n&&-1!==a&&n.changeModelInScene(a,t[a])}}var P=n(2037),D=n.n(P);n(4796);const T=({sceneNumber:e,initialScale:t,arCube:n})=>{const[a,s]=(0,k.useState)(t);return w().createElement("div",{className:"jlab-gather-scale-slider"},w().createElement("p",null,0===e?"First Model":"Second Model"),w().createElement(D(),{className:"slider",min:t/4,max:4*t,defaultValue:t,value:a,step:.001,onChange:t=>((e,t)=>{n&&(n.setScale(e,t),s(e))})(t,e)}))},R=()=>{const[e,t]=(0,k.useState)(void 0),[n,a]=(0,k.useState)(!1),[s,o]=(0,k.useState)(1),[i,r]=(0,k.useState)(1);(0,k.useEffect)((()=>{t(_.getState((0,g.selectAppData)("arCube"))),_.subscribe(l,(0,g.selectAppData)("arCube"))}),[]);const l=()=>{const e=_.getState((0,g.selectAppData)("arCube"));e&&(e.secondSceneSignal.connect(d),e.scaleSignal.connect(c),t(e))},c=(e,t)=>{0===t.sceneNumber?o(t.scale):r(t.scale)},d=(e,t)=>{a(t)};return w().createElement("div",{className:"jlab-gather-sidebar-container"},w().createElement("div",{className:"jlab-gather-sidebar-description"},"Set Scale"),w().createElement("div",{className:"jlab-gather-sidebar-list jlab-gather-sidebar-right"},w().createElement(T,{sceneNumber:0,initialScale:s,arCube:e}),n?w().createElement(T,{sceneNumber:1,initialScale:i,arCube:e}):null))};class V extends l.SidePanel{constructor(){super({content:new f.Panel}),this.addClass("jlab-gather-sidebar-widget"),this.title.icon=d,this.title.className,this.title.caption="Augmented reality";const e=document.createElement("h2");e.textContent="augmented reality",this.header.addWidget(new f.Widget({node:e}));const t=s.ReactWidget.create(w().createElement(R,null));this.content.addWidget(t)}}const L=({children:e})=>w().createElement("div",{className:"jlab-gather-avatar"},e),F=({peer:e,className:t})=>{const{videoRef:n}=(0,g.useVideo)({trackId:e.videoTrack}),a=(0,g.useHMSStore)(g.selectIsLocalVideoEnabled);return w().createElement("div",{className:`jlab-gather-peer-tile jlab-gather-peer-tile-${t}`},e.isHandRaised?w().createElement(y.FontAwesomeIcon,{icon:b.faHand,className:"jlab-gather-peer-hand-raised-icon"}):"",a?w().createElement(w().Fragment,null,w().createElement("video",{ref:n,className:`jlab-gather-peer-video jlab-gather-peer-video-${t} \n            ${e.isHandRaised?"jlab-gather-peer-hand-raised":""}\n            ${e.isLocal?"jlab-gather-local":""}`,autoPlay:!0,muted:!0,playsInline:!0}),w().createElement("div",{className:"jlab-gather-peer-name"},e.name)):w().createElement(L,null,(e=>{const t=e.split(/[_-\s]+/).map((e=>e.charAt(0)));return t?null==t?void 0:t.join(""):"Woops"})(e.name)))},B=()=>{const e=(0,g.useHMSStore)(g.selectPeers);return w().createElement("div",{className:"jlab-gather-main-grid-container"},w().createElement("div",{className:"jlab-gather-main-grid-view"},e.map((e=>w().createElement(F,{key:e.id,peer:e,className:"grid"})))))},z=({state:e})=>{const t=(0,g.useHMSActions)(),[n,a]=(0,k.useState)(""),s=(0,S.uniqueNamesGenerator)({dictionaries:[S.adjectives,S.colors,S.animals],style:"capital",separator:" "}),[o,i]=(0,k.useState)({userName:s,roomCode:n});(0,k.useEffect)((()=>{(async()=>{try{const t=await e.fetch("jupyterlab_gather");if(t){const e=t.roomCode;i({userName:s,roomCode:e}),a(e)}}catch(e){console.log("Error fetching room code",e)}})()}),[]);const r=e=>{i((t=>({...t,[e.target.name]:e.target.value})))};return w().createElement("form",{className:"jlab-gather-form",onSubmit:async n=>{n.preventDefault(),console.log("clicking join"),t.setAppData("isConnecting",!0);const{userName:a="",roomCode:s=""}=o;await e.save("jupyterlab_gather",{roomCode:s});const i={userName:a,authToken:await t.getAuthTokenByRoomCode({roomCode:s}),settings:{isAudioMuted:!0,isVideoMuted:!1},metaData:""};t.setAppData("config",i);try{await t.preview({...i})}catch(n){console.error(n)}}},w().createElement("h2",null,"Join Room"),w().createElement("div",{className:"jlab-gather-form-input"},w().createElement("label",{htmlFor:"userName"},"Username"),w().createElement("input",{required:!0,className:"jlab-gather-input",value:o.userName,onChange:r,type:"text",name:"userName",placeholder:"Your name"})),w().createElement("div",{className:"jlab-gather-form-input"},w().createElement("label",{htmlFor:"room-code"},"Room ID"),w().createElement("input",{type:"text",className:"jlab-gather-input",name:"roomCode",placeholder:"Room code",onChange:r,value:o.roomCode})),w().createElement("button",{className:"jlab-gather-btn-common jlab-gather-btn-primary"},"Join"))},H=({peers:e})=>w().createElement("div",{className:"jlab-gather-peer-sidepane-list"},e.map((e=>w().createElement(F,{key:e.id,peer:e,className:"sidepane"})))),G=({peer:e,className:t})=>{const{videoRef:n}=(0,g.useVideo)({trackId:e.videoTrack}),a=(0,g.useHMSStore)((0,g.selectVideoTrackByID)(e.videoTrack));return console.log("track preferred layer",a),w().createElement("video",{ref:n,className:t,autoPlay:!0,muted:!0,playsInline:!0,width:1280,height:720})},W=()=>{const e=(0,g.useHMSStore)(g.selectPeers),t=(0,g.useHMSStore)((0,g.selectSessionStore)("presenterId"));return(0,k.useEffect)((()=>{const e=document.getElementById("jlab-gather-control-bar");return null==e||e.classList.add("jlab-gather-transparent"),()=>{null==e||e.classList.remove("jlab-gather-transparent")}}),[]),w().createElement("div",{className:"jlab-gather-presenter-container-main"},w().createElement("div",{className:"jlab-gather-presenter-container"},t?w().createElement(w().Fragment,null,w().createElement(G,{peer:t,className:"jlab-gather-presenter-video"})):w().createElement("div",null,"Waiting...")),w().createElement(H,{peers:e.filter((e=>e.id!==(null==t?void 0:t.id)))}))},O=({trackId:e,className:t})=>{const{videoRef:n}=(0,g.useVideo)({trackId:e});return w().createElement("video",{ref:n,className:t,autoPlay:!0,muted:!0,playsInline:!0})},U=({list:e,onChange:t,title:n})=>w().createElement("div",{className:"jlab-gather-device-settings-row"},w().createElement("span",{className:"jlab-gather-device-title"},n,":"),(null==e?void 0:e.length)?w().createElement("select",{className:"jlab-gather-select jlab-gather-device-select",onChange:t},e.map((e=>w().createElement("option",{className:"device-option",value:e.deviceId,key:e.deviceId},e.label)))):w().createElement("select",{className:"jlab-gather-select jlab-gather-device-select"},w().createElement("option",{className:"device-option"},"Options Unavailable"))),q=({isOpen:e,onClose:t})=>{const n=(0,k.useRef)(null),{allDevices:a,updateDevice:s}=(0,g.useDevices)(),{videoInput:o,audioInput:i,audioOutput:r}=a;(0,k.useEffect)((()=>{e&&n.current&&setTimeout((()=>{n.current.focus()}),0)}),[e]);const l=(e,t)=>{s({deviceId:e,deviceType:t}),t===g.DeviceType.videoInput&&A.setAppData("videoDeviceId",e)};return w().createElement(E,{title:"Device Settings",hasCloseBtn:!0,isOpen:e,onClose:t},w().createElement("div",{className:"jlab-gather-device-settings-container"},w().createElement(U,{title:"Camera",list:o,onChange:e=>l(e.target.value,g.DeviceType.videoInput)}),w().createElement(U,{title:"Microphone",list:i,onChange:e=>l(e.target.value,g.DeviceType.audioInput)}),w().createElement(U,{title:"Speaker",list:r,onChange:e=>l(e.target.value,g.DeviceType.audioOutput)})))},$=()=>{const[e,t]=(0,k.useState)(!1);return w().createElement(w().Fragment,null,w().createElement("button",{className:"jlab-gather-btn-control",onClick:()=>{t(!0)}},w().createElement(y.FontAwesomeIcon,{icon:b.faGear,className:"jlab-gather-icon"})),w().createElement(q,{isOpen:e,onClose:()=>{t(!1)}}))},J=()=>{console.log("preview");const e=(0,g.useHMSActions)(),[t,n]=(0,k.useState)(!1),a=(0,g.useHMSStore)(g.selectLocalPeer),s=(0,g.useHMSStore)((0,g.selectAppData)("config"));return w().createElement("div",{className:"jlab-gather-preview-container-main"},w().createElement("div",{className:"jlab-gather-preview-container"},w().createElement("h2",null,"Get Started"),w().createElement("div",null,"Setup audio and video"),a?w().createElement(O,{className:"jlab-gather-preview-video jlab-gather-local",trackId:a.videoTrack}):w().createElement(y.FontAwesomeIcon,{icon:b.faSpinner,className:"jlab-gather-spinner large"}),w().createElement("div",{className:"jlab-gather-control-bar"},w().createElement("button",{className:"jlab-gather-btn-common jlab-gather-btn-primary",onClick:()=>{n(!0),e.join({...s}),n(!1)}},t?w().createElement(y.FontAwesomeIcon,{icon:b.faSpinner,className:"jlab-gather-spinner large"}):"Join"),w().createElement("button",{className:"jlab-gather-btn-common jlab-gather-btn-danger",onClick:()=>{e.setAppData("isConnecting",!1)}},"Back"),w().createElement($,null))))};var K=n(4949),Q=n(8881),Y=n(3533);const Z=class{constructor(){this.onSuccessfulLoad=(e,t,n)=>{console.log("on successful load",e,n);const a=e.scene;a.name=`model${t}`,a.children.forEach((e=>{const t=e.children.filter((e=>!e.name.startsWith("edge-")));e.children=t})),this.animations=e.animations,this.mixer=new Q.AnimationMixer(a),this.animations&&this.animations.forEach((e=>{this.mixer.clipAction(e).play()}));const s=(new Q.Box3).setFromObject(a),o=this.calcScale(this.bgCubeBoundingBox,s);a.scale.set(o,o,o);const i=(new Q.Box3).setFromObject(a),r=new Q.Vector3;i.getCenter(r),a.position.set(-r.x,-r.y,-r.z),this.sceneGroups[t].add(a),this.okToLoadModel=!0;const l=[...this.loadedModels.slice(0,t),n,...this.loadedModels.slice(t)];A.setAppData("loadedModels",l),A.setAppData("canLoadModel",!0),this.scaleSignal.emit({sceneNumber:t,scale:o}),console.log("model loaded parse")},this.secondSceneSignal=new h.Signal(this),this.scaleSignal=new h.Signal(this),this.bgCubeCenter=new Q.Vector3,this.initialize()}initialize(){this.sceneGroups=[],this.loadedModels=[],_.subscribe(this.setupSource.bind(this),(0,g.selectAppData)("videoDeviceId")),this.setupThreeStuff(),this.setupSource(),this.setupContext(),this.setupMarkerRoots(),this.setupScene(0)}setupThreeStuff(){console.log("setting up three stuff"),this.okToLoadModel=!0,this.scene=new Q.Scene,this.webcam_loaded=new Promise((e=>{this.resolve=e})),window.addEventListener("arjs-video-loaded",(e=>{e.detail.component.style.display="none",this.resolve()}));const e=new Q.AmbientLight(16777215,1);this.scene.add(e),this.camera=new Q.Camera,this.scene.add(this.camera);const t=new Q.DirectionalLight(16777215,1);if(t.position.set(-1,2,4),this.camera.add(t),this.renderer=new Q.WebGLRenderer({antialias:!0,alpha:!0,preserveDrawingBuffer:!0,premultipliedAlpha:!1}),this.renderer.setClearColor(new Q.Color("lightgrey"),0),_.getState(g.selectIsSomeoneScreenSharing)){console.log("iffing");const e=document.getElementById("screen-share-container");null==e||e.appendChild(this.renderer.domElement)}else console.log("elsing"),this.renderTarget=new Q.WebGLRenderTarget,this.renderTarget.setSize(1280,720),this.renderer.setRenderTarget(this.renderTarget);this.clock=new Q.Clock,this.deltaTime=0,this.totalTime=0,A.setAppData("renderer",this.renderer)}setupSource(){console.log("setting up source");const e=_.getState((0,g.selectAppData)("videoDeviceId"));this.arToolkitSource=new K.ArToolkitSource({sourceType:"webcam",deviceId:e}),this.arjsVid=document.getElementById("arjs-video"),this.arjsVid&&this.arjsVid.remove(),this.arToolkitSource.init()}setupContext(){console.log("setting up context"),this.arToolkitContext=new K.ArToolkitContext({cameraParametersUrl:K.ArToolkitContext.baseURL+"../data/data/camera_para.dat",detectionMode:"mono"}),this.arToolkitContext.init((()=>{this.camera.projectionMatrix.copy(this.arToolkitContext.getProjectionMatrix())}))}setupMarkerRoots(){console.log("setting up marker roots"),this.markerRootArray=[],this.markerGroupArray=[],this.hiroRootArray=[],this.hiroGroupArray=[],this.patternArray=["letterA","letterB","letterC","letterD","letterF","kanji"],this.patternArraySecondModel=["letterJ","letterK","letterL","letterM","letterN","letterP"];const e=[new Q.Vector3(-Math.PI/2,0),new Q.Vector3(0,-Math.PI/2,Math.PI/2),new Q.Vector3(Math.PI/2,0,Math.PI),new Q.Vector3(-Math.PI/2,Math.PI/2,0),new Q.Vector3(Math.PI,0,0),new Q.Vector3(0,0,0)];for(let t=0;t<6;t++){const n=new Q.Group;this.markerRootArray.push(n),this.scene.add(n),new K.ArMarkerControls(this.arToolkitContext,n,{type:"pattern",patternUrl:K.ArToolkitContext.baseURL+"examples/marker-training/examples/pattern-files/pattern-"+this.patternArray[t]+".patt"});const a=new Q.Group;this.markerGroupArray.push(a),a.position.y=-.625,a.rotation.setFromVector3(e[t]),n.add(a)}for(let t=0;t<6;t++){const n=new Q.Group;this.hiroRootArray.push(n),this.scene.add(n),new K.ArMarkerControls(this.arToolkitContext,n,{type:"pattern",patternUrl:"https://raw.githubusercontent.com/QuantStack/jupyterlab-gather/main/pattern-files/pattern-"+this.patternArraySecondModel[t]+".patt"});const a=new Q.Group;this.hiroGroupArray.push(a),a.position.y=-.625,a.rotation.setFromVector3(e[t]),n.add(a)}}setupScene(e){console.log("setting up scene");const t=new Q.Group;t.scale.set(.875,.875,.875),t.name=`scene${e}`,t.add(new Q.Mesh(new Q.BoxGeometry(2,2,2),new Q.MeshBasicMaterial({color:"#2EEEFF",side:Q.BackSide})));const n=new Q.Group,a=new Q.CylinderGeometry(.03,.03,2,32),s=[new Q.Vector3(0,-1,-1),new Q.Vector3(0,1,-1),new Q.Vector3(0,-1,1),new Q.Vector3(0,1,1),new Q.Vector3(-1,0,-1),new Q.Vector3(1,0,-1),new Q.Vector3(-1,0,1),new Q.Vector3(1,0,1),new Q.Vector3(-1,-1,0),new Q.Vector3(1,-1,0),new Q.Vector3(-1,1,0),new Q.Vector3(1,1,0)],o=[new Q.Vector3(0,0,Math.PI/2),new Q.Vector3(0,0,Math.PI/2),new Q.Vector3(0,0,Math.PI/2),new Q.Vector3(0,0,Math.PI/2),new Q.Vector3(0,0,0),new Q.Vector3(0,0,0),new Q.Vector3(0,0,0),new Q.Vector3(0,0,0),new Q.Vector3(Math.PI/2,0,0),new Q.Vector3(Math.PI/2,0,0),new Q.Vector3(Math.PI/2,0,0),new Q.Vector3(Math.PI/2,0,0)];for(let e=0;e<12;e++){const t=new Q.Mesh(a,new Q.MeshLambertMaterial({color:"#262626"}));t.position.copy(s[e]),t.rotation.setFromVector3(o[e]),n.add(t)}n.name="edge-group",t.add(n),this.sceneGroups.push(t),this.bgCubeBoundingBox||(this.bgCubeBoundingBox=(new Q.Box3).setFromObject(n),this.bgCubeBoundingBox.getCenter(this.bgCubeCenter)),this.loadModel(e),console.log("fin")}loadModel(e,t){console.log("loading model",e,t),this.gltfLoader||(this.gltfLoader=new Y.B);const n=t||"duck",a=this.findModelByName(n);if(console.log("model",a),this.okToLoadModel=!1,A.setAppData("canLoadModel",!1),"url"in a)this.gltfLoader.load(a.url,(t=>{this.onSuccessfulLoad(t,e,n)}),(()=>{console.log("model loading")}),(e=>{console.log("Error loading model url",e)}));else if("gltf"in a){const t=a.gltf;this.gltfLoader.parse(t,"",(t=>{this.onSuccessfulLoad(t,e,n)}),(e=>{console.log("Error loading model gltf",e)}))}}calcScale(e,t){const n=Math.abs(e.max.x-e.min.x),a=Math.abs(e.max.y-e.min.y),s=Math.abs(e.max.z-e.min.z),o=[n/Math.abs(t.max.x-t.min.x),a/Math.abs(t.max.y-t.min.y),s/Math.abs(t.max.z-t.min.z)];return Math.min(...o)}findModelByName(e){return _.getState((0,g.selectAppData)("modelRegistry")).find((t=>t.name===e))}changeModelInScene(e,t){const n=this.sceneGroups[e],a=n.getObjectByName(`model${e}`);a&&n.remove(a),this.loadModel(e,t)}removeFromScene(e,t){this.sceneGroups[e].remove(t)}enableSecondScene(){console.log("enabling second"),this.isSecondScene=!0,this.setupScene(1),this.secondSceneSignal.emit(!0)}disableSecondScene(){console.log("disabling second"),this.isSecondScene=!1,this.sceneGroups.pop(),this.hiroGroupArray.forEach((e=>{e.children.length>0&&e.remove(e.children[0])})),this.secondSceneSignal.emit(!1)}resizeCanvasToDisplaySize(){const e=this.renderer.domElement,t=e.clientWidth,n=e.clientHeight;e.width===t&&e.height===n||this.renderer.setSize(t,n,!1)}setScale(e,t){var n;null===(n=this.sceneGroups[t].getObjectByName(`model${t}`))||void 0===n||n.scale.set(e,e,e)}render(){this.renderer.render(this.scene,this.camera)}animate(){window.requestAnimationFrame(this.animate.bind(this)),this.deltaTime=this.clock.getDelta(),this.totalTime+=this.deltaTime,this.update(),this.mixer&&(this.mixerUpdateDelta=this.clock.getDelta(),this.mixer.update(this.mixerUpdateDelta)),this.render()}update(){!1!==this.arToolkitSource.ready&&this.arToolkitContext.update(this.arToolkitSource.domElement);for(let e=0;e<6;e++)if(this.markerRootArray[e].visible){this.markerGroupArray[e].add(this.sceneGroups[0]);break}if(this.isSecondScene)for(let e=0;e<6;e++)if(this.hiroRootArray[e].visible){this.hiroGroupArray[e].add(this.sceneGroups[1]);break}}},X=class{constructor(){this.input=null,this.output=null}blendImages(e,t){if(e.width!==t.width||e.height!==t.height)throw new Error("ImageData dimensions must match");const n=new ImageData(e.width,e.height);for(let a=0;a<n.data.length;a+=4){const s=t.data[a+3]/255,o=1-s;n.data[a]=e.data[a]*o+t.data[a]*s,n.data[a+1]=e.data[a+1]*o+t.data[a+1]*s,n.data[a+2]=e.data[a+2]*o+t.data[a+2]*s,n.data[a+3]=255}return n}flipImageDataVertically(e){const t=e.width,n=e.height,a=new Uint8ClampedArray(t*n*4);for(let s=0;s<n;s++)for(let o=0;o<t;o++){const i=4*(s*t+o),r=4*((n-s-1)*t+o);a[r]=e.data[i],a[r+1]=e.data[i+1],a[r+2]=e.data[i+2],a[r+3]=e.data[i+3]}return new ImageData(a,t,n)}processVideoFrame(e,t){if(!e||!t)throw new Error("Plugin invalid input/output");this.input=e,this.output=t;const n=e.width,a=e.height;t.width=n,t.height=a;const s=e.getContext("2d"),o=null==s?void 0:s.getImageData(0,0,n,a),i=new Uint8Array(n*a*4);this.arCube.renderer.readRenderTargetPixels(this.arCube.renderTarget,0,0,n,a,i);const r=new ImageData(new Uint8ClampedArray(i),n,a),l=t.getContext("2d");o||console.log("no image input data");const c=this.flipImageDataVertically(r),d=this.blendImages(o,c);null==l||l.putImageData(d,0,0)}getName(){return"arcube-plugin"}isSupported(){return!0}checkSupport(){return{isSupported:!0}}async init(){this.arCube=new Z,A.setAppData("arCube",this.arCube),this.arCube.animate()}getPluginType(){return C.Nq.TRANSFORM}getContextType(){return C.iu["2D"]}stop(){const e=document.getElementById("arjs-video");null==e||e.remove()}},ee=()=>{const e=(0,g.useHMSActions)(),t=(0,g.useHMSStore)(g.selectLocalPeer),n=(0,g.useHMSStore)((0,g.selectSessionStore)("isPresenting")),a=(0,g.useHMSStore)((0,g.selectSessionStore)("presenterId")),s=(0,g.useHMSStore)(g.selectLocalPeerRole),o=new X,i=(0,g.useHMSStore)((0,g.selectIsLocalVideoPluginPresent)(o.getName())),[r,l]=(0,k.useState)(!1),[c,d]=(0,k.useState)();(0,k.useEffect)((()=>{e.sessionStore.observe("isPresenting"),e.sessionStore.observe("presenterId"),s&&d(s)}),[e]),(0,k.useEffect)((()=>{a&&(null==t?void 0:t.id)!==a.id?l(!0):l(!1)}),[n,a]);const p=n=>{t&&n?e.changeRoleOfPeer(t.id,n,!0):console.log("Problem setting role")};return w().createElement("button",{className:"jlab-gather-btn-control",onClick:async()=>{i||n?(console.log("removing"),p(null==c?void 0:c.name),e.sessionStore.set("isPresenting",!1),e.sessionStore.set("presenterId",""),await e.removePluginFromVideoTrack(o)):(console.log("adding"),p("presenter"),e.sessionStore.set("isPresenting",!0),e.sessionStore.set("presenterId",t),await e.addPluginToVideoTrack(o))},disabled:r},r?w().createElement(y.FontAwesomeIcon,{icon:b.faBan,className:"jlab-gather-icon"}):n||i?w().createElement(y.FontAwesomeIcon,{icon:b.faEyeSlash,className:"jlab-gather-icon"}):w().createElement(y.FontAwesomeIcon,{icon:b.faEye,className:"jlab-gather-icon"}))},te=()=>{const e=(0,g.useHMSStore)(g.selectLocalPeerID),t=(0,g.useHMSStore)((0,g.selectHasPeerHandRaised)(e)),n=(0,g.useHMSActions)(),a=(0,k.useCallback)((async()=>{t?await n.lowerLocalPeerHand():await n.raiseLocalPeerHand()}),[n,t]);return w().createElement("button",{className:"jlab-gather-btn-control",onClick:a},w().createElement(y.FontAwesomeIcon,{icon:b.faHand,className:"jlab-gather-icon "+(t?"jlab-gather-icon-breathe":"")}))},ne=()=>{const e=(0,g.useHMSActions)(),t=(0,g.useHMSStore)(g.selectLocalPeer),n=(0,g.useHMSStore)((0,g.selectSessionStore)("presenterId")),{isLocalAudioEnabled:a,isLocalVideoEnabled:s,toggleAudio:o,toggleVideo:i}=(0,g.useAVToggle)();return(0,k.useEffect)((()=>{e.sessionStore.observe("presenterId")}),[e]),w().createElement("div",{id:"jlab-gather-control-bar",className:"jlab-gather-control-bar"},w().createElement("button",{className:"jlab-gather-btn-control",onClick:o},a?w().createElement(y.FontAwesomeIcon,{icon:b.faMicrophone,className:"jlab-gather-icon"}):w().createElement(y.FontAwesomeIcon,{icon:b.faMicrophoneSlash,className:"jlab-gather-icon"})),w().createElement("button",{className:"jlab-gather-btn-control",onClick:i},s?w().createElement(y.FontAwesomeIcon,{icon:b.faVideo,className:"jlab-gather-icon"}):w().createElement(y.FontAwesomeIcon,{icon:b.faVideoSlash,className:"jlab-gather-icon"})),w().createElement(ee,null),w().createElement(te,null),w().createElement($,null),w().createElement("button",{className:"jlab-gather-btn-control jlab-gather-btn-danger",onClick:async()=>{(null==t?void 0:t.id)===(null==n?void 0:n.id)&&(await e.sessionStore.set("isPresenting",!1),await e.sessionStore.set("presenterId","")),e.leave()}},w().createElement(y.FontAwesomeIcon,{icon:b.faPersonThroughWindow,className:"jlab-gather-icon"})))},ae=({state:e})=>{const t=(0,g.useHMSActions)(),n=(0,g.useHMSStore)(g.selectIsConnectedToRoom),a=(0,g.useHMSStore)((0,g.selectAppData)("isConnecting")),s=(0,g.useHMSStore)((0,g.selectSessionStore)("isPresenting"));return(0,k.useEffect)((()=>{n&&t.setAppData("isConnecting",!1)}),[n]),(0,k.useEffect)((()=>{n&&(t.sessionStore.observe("isPresenting"),t.sessionStore.observe("presenterId")),window.onunload=()=>{n&&t.leave()}}),[t,n]),w().createElement(w().Fragment,null,s?w().createElement(W,null):n?w().createElement(B,null):a?w().createElement(J,null):w().createElement(z,{state:e}),n&&w().createElement(ne,null))},se=({node:e,modelRegistryChanged:t,state:n})=>{const a=(0,k.useRef)(null);return(0,k.useEffect)((()=>{if(a.current){const e=a.current.parentElement;null==e||e.classList.add("jlab-gather-overflow")}}),[a]),w().createElement("div",{ref:a,className:"jlab-gather-root"},w().createElement(ae,{state:n}))};class oe extends l.ReactWidget{constructor(e,t){super(),this._modelRegistryChanged=e,this._state=t}render(){return w().createElement(N,null,w().createElement(se,{node:this.node,modelRegistryChanged:this._modelRegistryChanged,state:this._state}))}}const ie=[{id:"jupyterlab_gather",description:"Video presentation over WebRTC with AR capabilities.",autoStart:!0,requires:[s.ICommandPalette,o.ILauncher,m,r.IStateDB],optional:[a.ILayoutRestorer,i.ISettingRegistry],activate:(e,t,n,a,o,i,r)=>{let l;console.log("JupyterLab extension jupyterlab_gather is activated!");const d="gather:open";e.commands.addCommand(d,{label:"Start Gather",icon:c,execute:()=>{if(!l||l.isDisposed){const e=new oe(a.modelRegistryChanged,o);l=new s.MainAreaWidget({content:e}),l.id="gather-jupyterlab",l.title.label="AR Presentation",l.title.closable=!0,l.title.icon=c}l.isAttached||e.shell.add(l,"main");const t=new x(a);t.id="gather-leftSidePanel";const n=new V;n.id="gather-rightSidePanel",e.shell.activateById(l.id),e.shell.add(l,"main"),e.shell.add(t,"left",{rank:2e3}),e.shell.add(n,"right",{rank:2e3}),a.registerModel({name:"duck",url:"https://github.khronos.org/glTF-Sample-Viewer-Release/assets/models/Models/Duck/glTF/Duck.gltf"}),a.registerModel({name:"fox",url:"https://github.khronos.org/glTF-Sample-Viewer-Release/assets/models/Models/Fox/glTF/Fox.gltf"})}}),t.addItem({command:d,category:"Video Chat"}),n&&n.add({command:d,category:"Video Chat",rank:2})}},{id:"jupyterlab_gather:registry",description:"Registry of available models to display in ar present",autoStart:!0,requires:[],provides:m,activate:()=>new u}]}}]);