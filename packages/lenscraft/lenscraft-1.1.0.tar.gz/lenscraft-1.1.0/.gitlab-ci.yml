stages:
  - build
  - deploy

build:
  image: python:3.9
  tags:
    - dind
  stage: build
  script:
    - git fetch --tags
    - pip install --upgrade build
    - python -m build
  artifacts:
    paths:
      - dist/
    expire_in: 1 hour 

deploy:
  image: python:3.9
  tags:
    - dind
  stage: deploy
  dependencies:
    - build
  script:
    - git fetch --tags
    - pip install twine
    - python -m twine upload --repository pypi dist/*
  rules:
    - if: $CI_COMMIT_TAG =~ /^(?:\d+.){2}(?:\d+)$/