const __vite__fileDeps=["assets/pdf-doc-obrBwxa6.js","assets/admin-drawer-panel-BxoNUHQr.js","assets/admin-drawer-panel-o87BwD38.css","assets/main-Dy9Uqpmh.js","assets/main-Ztp855PW.css","assets/pdf-doc-CMzaSV_K.css"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{an as v,V as P,W as _,_ as b,Y as h,Z as d,X as g,$ as l,S as n,ao as y,ak as k,ap as f,al as R,aK as S,aH as w,aZ as ee,U as B,bD as fe,bE as ve,aw as F,bF as te,bG as oe,aJ as ae,bH as se,bI as Pe,b8 as we,b7 as T,bA as Se,aI as V,bv as re,aU as s,b5 as ye,bJ as Ce,bK as Re,D as M,aq as W,ar as z,bL as Be,bM as Te,bN as De,bO as Ie,bP as Le,aV as $e,aW as Ve,aQ as Oe,m as D,bQ as Ne,av as ne,aX as H,bR as Ae,bS as Ee,bm as Ue,am as xe,bT as Fe,bo as ze,bU as Me,ba as q,br as We,bV as He}from"./admin-drawer-panel-BxoNUHQr.js";import{b as c,c as qe,_ as Ge,S as A,d as ie,e as Ke,h as je}from"./main-Dy9Uqpmh.js";import{d as Ye,b as Xe,S as Ze,V as Je,a as Qe}from"./settings-drawer-7iTnAdjf.js";import{P as et,a as le,U as tt,V as ot}from"./unauthorized-Bs7NSqea.js";import{b as ce,V as de}from"./VWindowItem-iyZ1XOkP.js";import{b as at}from"./VSelect-DgfIKRnC.js";import{V as st,a as rt,b as nt,c as it}from"./VExpansionPanels-CRevojaF.js";import{V as I,a as E}from"./VRadioGroup-8nrrxjDv.js";import{V as U}from"./VCheckbox-BOUtyxuo.js";import{T as lt,M as ct,V as x,a as dt,P as ue,b as ut,c as ht}from"./pagination-toolbar-DbS_HOT1.js";import"./copy-to-clipboard-DoUvDJVx.js";import"./VDialog-X0zn9AGX.js";import"./change-password-dialog-DZ9dP8_F.js";import"./VTextField-Bs8oq9mk.js";import"./VSelectionControl-CGu0oz0K.js";import"./VCheckboxBtn-B1-m5pEh.js";import"./VSlideGroup-D_oNvCOd.js";import"./to-case-CR9beRR0.js";const gt={name:"BookChangeDrawer",props:{direction:{type:String,required:!0}},head(){if(this.isDrawerOpen)return this.prefetchLinks(this.params,this.computedDirection,!0)},computed:{...v(c,["isBTT"]),...P(c,{computedDirection(){return this.normalizeDirection(this.direction)},params(e){return e.routes.books[this.computedDirection]},isDrawerOpen(e){return e.bookChange===this.computedDirection},icon(){return this.bookChangeIcon(this.computedDirection)}}),drawerLocation(){return this.bookChangeLocation(this.direction)},cursorClass(){return this.bookChangeCursorClass(this.computedDirection)},show(){return this.bookChangeShow(this.computedDirection)},route(){return this.toRoute(this.params)},label(){return this.linkLabel(this.computedDirection,"Book")}},methods:{..._(c,["getSettings","linkLabel","normalizeDirection","prefetchLinks","toRoute","bookChangeLocation","bookChangeCursorClass","bookChangeShow","bookChangeIcon"])}};function pt(e,t,a,u,i,o){const r=h("router-link");return o.show?(d(),g(Ye,{key:0,class:R(["bookChangeDrawer",{drawerActivated:e.isDrawerOpen}]),"disable-resize-watcher":"","disable-route-watcher":"",location:o.drawerLocation,"model-value":e.isDrawerOpen,scrim:!1,temporary:"",touchless:""},{default:l(()=>[n(r,{class:R({navLink:!0,[o.cursorClass]:!0}),to:o.route,"aria-label":o.label,title:o.label,onClick:t[0]||(t[0]=p=>p.stopImmediatePropagation())},{default:l(()=>[n(y,{class:"bookChangeIcon"},{default:l(()=>[k(f(e.icon),1)]),_:1})]),_:1},8,["class","to","aria-label","title"])]),_:1},8,["location","model-value","class"])):S("",!0)}const mt=b(gt,[["render",pt],["__scopeId","data-v-03e41a14"]]),kt={name:"BookChangeActivator",components:{BookChangeDrawer:mt},props:{direction:{type:String,required:!0}},computed:{computedDirection(){return this.normalizeDirection(this.direction)},positionClass(){return this.bookChangeLocation(this.direction)+"Pos"},cursorClass(){return this.bookChangeCursorClass(this.direction)},show(){return this.bookChangeShow(this.computedDirection)}},methods:{..._(c,["setBookChangeFlag","normalizeDirection","bookChangeLocation","bookChangeCursorClass","bookChangeShow"])}};function bt(e,t,a,u,i,o){const r=h("BookChangeDrawer");return d(),w(B,null,[o.show?(d(),w("div",{key:0,class:R(["bookChangeColumn",{[o.positionClass]:!0,[o.cursorClass]:!0}]),onClick:t[0]||(t[0]=ee(p=>e.setBookChangeFlag(a.direction),["stop"]))},null,2)):S("",!0),n(r,{direction:a.direction},null,8,["direction"])],64)}const _t=b(kt,[["render",bt],["__scopeId","data-v-db3eb561"]]),ft={name:"LoadingPage",components:{Placeholder:et},props:{twoPages:{type:Boolean,required:!0}}};function vt(e,t,a,u,i,o){const r=h("Placeholder");return d(),w("div",{class:R(["pageLoading",{twoPages:a.twoPages}])},[n(r,{class:"pagePlaceholder"})],2)}const Pt=b(ft,[["render",vt],["__scopeId","data-v-04027168"]]),G="unauthorized",wt={name:"ErrorPage",props:{twoPages:{type:Boolean,required:!0},type:{type:String,required:!0}},computed:{text(){return this.type===G?"Protected page":"Failed to load page"},icon(){return this.type===G?fe:ve}}};function St(e,t,a,u,i,o){return d(),g(le,{class:R(["pageError",{twoPages:a.twoPages}]),headline:o.text,icon:o.icon},null,8,["class","headline","icon"])}const yt=b(wt,[["render",St],["__scopeId","data-v-417a4cab"]]),Ct={name:"ImgPage",props:{book:{type:Object,required:!0},src:{type:String,required:!0}},emits:["load","error"],computed:{...P(c,{scale:e=>e.clientSettings.scale}),style(){const e={};if(this.scale==1)return e;const t=this.$el;if(!(t!=null&&t.naturalWidth))return e;const a=t.naturalWidth/2;return e.transformOrigin=`${a}px top`,e.transform=`scale(${this.scale})`,e},classes(){return this.fitToClass(this.book)}},methods:{..._(c,["fitToClass"])}},Rt=["src"];function Bt(e,t,a,u,i,o){return d(),w("img",F({class:[o.classes,"img"],draggable:"false",src:a.src,style:o.style},e.$attrs,{onError:t[0]||(t[0]=r=>e.$emit("error",r)),onLoad:t[1]||(t[1]=r=>e.$emit("load",r))}),null,16,Rt)}const K=b(Ct,[["render",Bt],["__scopeId","data-v-559e2ecc"]]),j=te(oe(()=>Ge(()=>import("./pdf-doc-obrBwxa6.js"),__vite__mapDeps([0,1,2,3,4,5])))),Tt=333,Dt={name:"BookPage",components:{ErrorPage:yt,LoadingPage:Pt,PDFDoc:j,ImgPage:K},props:{book:{type:Object,required:!0},page:{type:Number,required:!0}},data(){return{showProgress:!1,loaded:!1,error:!1}},computed:{...v(c,["isVertical"]),...P(c,{scale:e=>e.clientSettings.scale}),style(){var a;const e={};if(this.book.fileType==="PDF"||this.scale==1)return e;const t=(a=this.$refs.pageComponent)==null?void 0:a.$el;return t!=null&&t.naturalHeight&&(e.height=t.naturalHeight*this.scale+"px",e.width=t.naturalWidth*this.scale+"px"),e},src(){const e={pk:this.book.pk,page:this.page,mtime:this.book.mtime};return qe(e)},component(){return this.book.fileType==="PDF"?j:K},settings(){return this.getSettings(this.book)}},mounted(){setTimeout(function(){this.loaded||(this.loading=!0)},Tt)},methods:{..._(c,["getSettings"]),onLoad(){this.showProgress=!1,this.loaded=!0,this.error=!1},onError(){this.error="load",this.showProgress=!1},onUnauthorized(){this.error="unauthorized",this.showProgress=!1}}},It=["id","data-page"];function Lt(e,t,a,u,i,o){const r=h("ErrorPage"),p=h("LoadingPage");return d(),w("div",{id:`page${a.page}`,"data-page":a.page,class:"page",style:se(o.style)},[i.error?(d(),g(r,{key:0,"two-pages":o.settings.twoPages,type:i.error},null,8,["two-pages","type"])):i.showProgress&&!i.loaded?(d(),g(p,{key:1,"two-pages":o.settings.twoPages},null,8,["two-pages"])):(d(),g(ae(o.component),{key:2,ref:"pageComponent",book:a.book,page:1,src:o.src,onError:o.onError,onLoad:o.onLoad,onUnauthorized:o.onUnauthorized},null,40,["book","src","onError","onLoad","onUnauthorized"]))],12,It)}const he=b(Dt,[["render",Lt],["__scopeId","data-v-87996fa1"]]),$t=.5,Vt={name:"ScaleForScroll",emits:["click"],data(){return{mdiMagnifyMinusOutline:Pe}},computed:{...P(c,{scale:e=>e.clientSettings.scale}),showReset(){return this.scale!=A},style(){return{cursor:this.scale==A?"zoom-in":"all-scroll"}}},methods:{..._(c,["setSettingsClient"]),clearSelection(){window.getSelection&&window.getSelection().removeAllRanges()},onDoubleClick(){this.clearSelection();const e=this.scale+$t;this.setSettingsClient({scale:e})},scaleReset(){this.setSettingsClient({scale:A})}}};function Ot(e,t,a,u,i,o){const r=we("drag-scroller");return T((d(),w("div",{class:"scaleForScroll",style:se(o.style),onDblclick:t[0]||(t[0]=(...p)=>o.onDoubleClick&&o.onDoubleClick(...p))},[Se(e.$slots,"default",{},void 0,!0),o.showReset?(d(),g(y,{key:0,class:"resetIcon",onClick:ee(o.scaleReset,["stop"])},{default:l(()=>[k(f(i.mdiMagnifyMinusOutline),1)]),_:1},8,["onClick"])):S("",!0)],36)),[[r,,void 0,{onlyX:!0}]])}const ge=b(Vt,[["render",Ot],["__scopeId","data-v-b24267c0"]]),Nt={name:"HorizontalPages",components:{BookPage:he,ScaleForScroll:ge},props:{book:{type:Object,required:!0},page:{type:Number,required:!0}},emits:["click"],computed:{...v(c,["isCoverPage","isReadInReverse"]),showSecondPage(){return this.getSettings(this.book).twoPages&&this.page<this.book.maxPage&&!this.isCoverPage(this.book,this.page)},showPageOne(){return!this.isReadInReverse||this.showSecondPage},showPageTwo(){return this.isReadInReverse||this.showSecondPage},pageOne(){return this.isReadInReverse?this.page+1:this.page},pageTwo(){return this.isReadInReverse?this.page:this.page+1}},methods:{..._(c,["getSettings"])}};function At(e,t,a,u,i,o){const r=h("BookPage"),p=h("ScaleForScroll");return d(),g(p,{class:"noWrap"},{default:l(()=>[o.showPageOne?(d(),g(r,{key:0,ref:"pageOne",book:a.book,page:o.pageOne,class:"horizontalPage"},null,8,["book","page"])):S("",!0),o.showPageTwo?(d(),g(r,{key:1,book:a.book,page:o.pageTwo,class:"horizontalPage"},null,8,["book","page"])):S("",!0)]),_:1})}const Et=b(Nt,[["render",At],["__scopeId","data-v-9a560964"]]),Ut={name:"PageChangeLink",props:{direction:{type:String,required:!0}},head(){return this.prefetchLinks(this.params,this.computedDirection)},computed:{...v(c,["isVertical","isFirstPage","isLastPage"]),...P(c,{params(e){return e.routes[this.computedDirection]}}),computedDirection(){return this.normalizeDirection(this.direction)},show(){return this.computedDirection==="prev"?!this.isFirstPage:!this.isLastPage},pageChangeClass(){let e="pageChange";return e+=this.isVertical?"Row":"Column",e},directionClass(){let e=this.direction;return this.isVertical&&(e+="Vertical"),e},route(){return this.toRoute(this.params)},label(){return this.linkLabel(this.computedDirection,"Page")}},methods:{..._(c,["getSettings","linkLabel","normalizeDirection","prefetchLinks","toRoute"])}};function xt(e,t,a,u,i,o){const r=h("router-link");return o.show?(d(),g(r,{key:0,to:o.route,"aria-label":o.label,class:R({[o.pageChangeClass]:!0,[o.directionClass]:!0}),onClick:t[0]||(t[0]=p=>p.stopImmediatePropagation())},null,8,["to","aria-label","class"])):S("",!0)}const Ft=b(Ut,[["render",xt],["__scopeId","data-v-9ade7d96"]]),zt=48,Mt=48,Wt={name:"PagerHorizontal",components:{HorizontalPages:Et,PageChangeLink:Ft},props:{book:{type:Object,required:!0}},data(){return{activePage:0,pages:[]}},computed:{...v(c,["isReadInReverse"]),...P(c,{prevBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.prev},nextBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.next},storePage:e=>e.page,storePk:e=>e.books.current.pk}),twoPages(){return this.getSettings(this.book).twoPages},windowIndex(){const e=this.activePage-this.pages[0];return Math.min(Math.max(0,e),this.book.maxPage)}},watch:{twoPages(){this.setActivePage(this.storePage,!0)},storePage(e){if(this.book.pk===this.storePk){this.activePage=e;const t=this.pages.at(0),a=this.pages.at(-1);(e<t||e>a)&&this.setPages()}},prevBook(e){this.book.pk===e.pk&&(this.activePage=this.book.maxPage)},nextBook(e){this.book.pk===e.pk&&(this.activePage=0)}},created(){this.book.pk===this.storePk?this.activePage=+this.$route.params.page:this.book.pk===this.prevBook.pk?this.activePage=this.book.maxPage:this.activePage=0,this.setPages()},methods:{..._(c,["getSettings","setBookChangeFlag","setActivePage"]),setPages(){const e=Math.max(this.activePage-zt,0),t=Math.min(this.activePage+Mt,this.book.maxPage),a=ie.range(e,t+1);this.pages=a}}};function Ht(e,t,a,u,i,o){const r=h("PageChangeLink"),p=h("HorizontalPages");return d(),g(de,{"show-arrows":"",continuous:"","model-value":o.windowIndex,reverse:e.isReadInReverse},{prev:l(()=>[n(r,{direction:"prev"})]),next:l(()=>[n(r,{direction:"next"})]),default:l(()=>[(d(!0),w(B,null,V(i.pages,m=>(d(),g(ce,{key:`c/${a.book.pk}/${m}`,class:"windowItem",disabled:"",eager:m>=e.storePage-1&&m<=e.storePage+2,"model-value":m,transition:!0},{default:l(()=>[n(p,{book:a.book,page:m},null,8,["book","page"])]),_:2},1032,["eager","model-value"]))),128))]),_:1},8,["model-value","reverse"])}const Y=b(Wt,[["render",Ht],["__scopeId","data-v-e04bbc00"]]);function pe(e,t){const{self:a=!1}=t.modifiers??{},u=t.value,i=typeof u=="object"&&u.options||{passive:!0},o=typeof u=="function"||"handleEvent"in u?u:u.handler,r=a?e:t.arg?document.querySelector(t.arg):window;r&&(r.addEventListener("scroll",o,i),e._onScroll=Object(e._onScroll),e._onScroll[t.instance.$.uid]={handler:o,options:i,target:a?void 0:r})}function me(e,t){var o;if(!((o=e._onScroll)!=null&&o[t.instance.$.uid]))return;const{handler:a,options:u,target:i=e}=e._onScroll[t.instance.$.uid];i.removeEventListener("scroll",a,u),delete e._onScroll[t.instance.$.uid]}function qt(e,t){t.value!==t.oldValue&&(me(e,t),pe(e,t))}const Gt={mounted:pe,unmounted:me,updated:qt},Kt=12,X=250,jt={name:"PagerVertical",components:{BookPage:he,ScaleForScroll:ge},props:{book:{type:Object,required:!0}},data(){return{innerHeight:window.innerHeight,innerWidth:window.innerWidth,intersectorOn:!1,programmaticScroll:!1}},computed:{...P(c,{storePage:e=>e.page}),...re(c,["reactWithScroll"]),settings(){return this.getSettings(this.book)},readInReverse(){return this.settings.readInReverse},items(){var a;const e=(a=this.book)!=null&&a.maxPage?this.book.maxPage+1:0,t=ie.range(0,e);return this.readInReverse&&t.reverse(),t},visibleItems(){var e;return Math.min(((e=this.book)==null?void 0:e.maxPage)??0,Kt)}},watch:{storePage(e){this.reactWithScroll&&this.scrollToPage(e)}},mounted(){window.addEventListener("resize",this.onResize),setTimeout(()=>{this.scrollToPage(this.storePage)},X)},beforeUnmount(){window.removeEventListener("resize",this.onResize)},methods:{..._(c,["setActivePage","setBookChangeFlag","getSettings"]),onIntersect(e,t){if(e&&this.intersectorOn){const u=+t[0].target.dataset.page;this.setActivePage(u,!1)}},onScroll(){if(this.programmaticScroll)return;this.intersectorOn=!0;const e=this.$refs.verticalScroll.$el,t=e.scrollTop;if(this.storePage===0&&t===0)this.setBookChangeFlag("prev");else if(this.storePage===this.book.maxPage){const a=e.scrollTopMax||e.scrollHeight-e.clientTop;window.innerHeight+t+1>=a&&this.setBookChangeFlag("next")}},scrollToPage(e){this.intersectorOn=!1,this.programmaticScroll=!0;const t=this.$refs.verticalScroll;t?t.scrollToIndex(e):console.debug("Can't find verticalScroll component."),setTimeout(()=>{this.programmaticScroll=!1},X)},onResize(){this.innerHeight=window.innerHeight,this.innerWidth=window.innerWidth}}},Yt=["data-page"];function Xt(e,t,a,u,i,o){const r=h("BookPage"),p=h("ScaleForScroll");return d(),g(p,null,{default:l(()=>[T((d(),g(at,{id:"verticalScroll",key:o.readInReverse,ref:"verticalScroll",items:o.items,height:i.innerHeight,width:i.innerWidth},{default:l(({item:m})=>[n(r,{book:a.book,page:m,class:"verticalPage"},null,8,["book","page"]),T(s("div",{class:"pageTracker","data-page":m},null,8,Yt),[[ye,{handler:o.onIntersect,options:{threshold:[.75]}},void 0,{quiet:!0}]])]),_:1},8,["items","height","width"])),[[Gt,o.onScroll,"#verticalScroll"]])]),_:1})}const Z=b(jt,[["render",Xt],["__scopeId","data-v-97638fc3"]]),J=te(oe(()=>"@/components/reader/pager/pager-full-pdf.vue")),Zt={name:"PagerSelector",components:{PagerHorizontal:Y,PagerPDF:J,PagerVertical:Z},props:{book:{type:Object,required:!0}},emits:["click"],head(){return this.prefetchBook(this.book)},computed:{...v(c,["isVertical","cacheBook"]),...P(c,{storePk:e=>{var t,a;return((a=(t=e.books)==null?void 0:t.current)==null?void 0:a.pk)||0}}),readFullPdf(){return this.book.fileType=="PDF"&&this.cacheBook},component(){return this.readFullPdf?J:this.isVertical?Z:Y}},watch:{$route(e){+e.params.pk===this.book.pk&&this.setActivePage(+e.params.page,!0)}},created(){this.book.pk===this.storePk&&this.setActivePage(+this.$route.params.page,!0)},methods:{..._(c,["getSettings","setActivePage","prefetchBook"])}};function Jt(e,t,a,u,i,o){return d(),g(ae(o.component),{book:a.book},null,8,["book"])}const Qt=b(Zt,[["render",Jt]]),eo={name:"BooksWindow",components:{BookChangeActivator:_t,Pager:Qt},emits:["click"],computed:{...v(c,["isBTT"]),...P(c,{books:e=>[e.books.prev,e.books.current,e.books.next].filter(Boolean),bookChange:e=>e.bookChange,currentBookPk:e=>{var t,a;return((a=(t=e.books)==null?void 0:t.current)==null?void 0:a.pk)||0},bookRoutes:e=>e.routes.books})},watch:{$route(e,t){(!t||!t.params||+e.params.pk!=+t.params.pk)&&this.loadBooks(e.params)}},beforeMount(){this.setBookChangeFlag(),this.loadBooks()},methods:{..._(c,["setBookChangeFlag","loadBooks"]),click(){this.setBookChangeFlag(),this.$emit("click")},eager(e){return this.bookChange&&this.bookRoutes[this.bookChange]&&this.bookRoutes[this.bookChange].pk===e}}};function to(e,t,a,u,i,o){const r=h("BookChangeActivator"),p=h("Pager");return d(),g(de,{id:"booksWindow",direction:"vertical","model-value":e.currentBookPk,reverse:e.isBTT,"show-arrows":"",onClick:o.click},{prev:l(()=>[n(r,{direction:"prev"})]),next:l(()=>[n(r,{direction:"next"})]),default:l(()=>[(d(!0),w(B,null,V(e.books,m=>(d(),g(ce,{key:`c/${m.pk}`,class:"windowItem",disabled:"",eager:o.eager(m.pk),value:m.pk,transition:!0},{default:l(()=>[n(p,{book:m,onClick:o.click},null,8,["book","onClick"])]),_:2},1032,["eager","value"]))),128))]),_:1},8,["model-value","reverse","onClick"])}const oo=b(eo,[["render",to],["__scopeId","data-v-93d2206c"]]),ao={name:"DownloadPanel",data(){return{mdiDownload:Ce,mdiFileImage:Re}},computed:{...v(c,["activeTitle","routeParams"]),...P(c,{currentBook:e=>{var t;return(t=e.books)==null?void 0:t.current},storePage:e=>e.page}),downloadURL(){return Ke(this.currentBook)},filename(){var e;return(e=this.currentBook)==null?void 0:e.filename},pageSrc(){const{pk:e,mtime:t}=this.currentBook;return je({pk:e,page:this.storePage,mtime:t})},pageName(){return`${this.activeTitle} - page ${this.storePage}.jpg`}},methods:{..._(M,["downloadIOSPWAFix"]),downloadPage(){this.downloadIOSPWAFix(this.pageSrc,this.pageName)},downloadBook(){this.downloadIOSPWAFix(this.downloadURL,this.filename)}}},so={key:0,id:"downloadPanel"};function ro(e,t,a,u,i,o){return e.currentBook?(d(),w("div",so,[n(z,{onClick:o.downloadPage},{default:l(()=>[n(W,null,{default:l(()=>[n(y,null,{default:l(()=>[k(f(i.mdiFileImage),1)]),_:1}),k("Download Page "+f(e.storePage),1)]),_:1})]),_:1},8,["onClick"]),n(z,{onClick:o.downloadBook},{default:l(()=>[n(W,null,{default:l(()=>[n(y,null,{default:l(()=>[k(f(i.mdiDownload),1)]),_:1}),k("Download Book ")]),_:1})]),_:1},8,["onClick"])])):S("",!0)}const no=b(ao,[["render",ro],["__scopeId","data-v-9e01f4cb"]]),io={name:"KeyboardShortcutsPanel",data(){return{mdiMenuLeft:Be,mdiMenuRight:Te,mdiKeyboardOutline:De,mdiKeyboardSpace:Ie,mdiAppleKeyboardShift:Le}},computed:{...v(M,["isMobile"])}},C=e=>($e("data-v-a8b4ac47"),e=e(),Ve(),e),lo=C(()=>s("h4",null,"Navigation",-1)),co={class:"highlight-table"},uo=C(()=>s("td",null,"Previous page",-1)),ho=C(()=>s("td",null,"Next page",-1)),go=C(()=>s("tr",null,[s("td",null,","),s("td",null,[k("Next "),s("em",null,"only"),k(" one page in two page mode.")])],-1)),po=C(()=>s("tr",null,[s("td",null,"."),s("td",null,[k("Previous "),s("em",null,"only"),k(" one page in two page mode.")])],-1)),mo=C(()=>s("tr",null,[s("td",null,"p"),s("td",null,"Previous Book")],-1)),ko=C(()=>s("tr",null,[s("td",null,"n"),s("td",null,"Next Book")],-1)),bo=C(()=>s("tr",null,[s("td",null,"esc"),s("td",null,"Close book")],-1)),_o=C(()=>s("h4",null,"Fit Page To",-1)),fo=C(()=>s("table",{class:"highlight-table"},[s("tbody",null,[s("tr",null,[s("td",null,"s"),s("td",null,"screen")]),s("tr",null,[s("td",null,"h"),s("td",null,"screen height")]),s("tr",null,[s("td",null,"w"),s("td",null,"screen width")]),s("tr",null,[s("td",null,"o"),s("td",null,"Show page at original size")]),s("tr",null,[s("td",null,"2"),s("td",null,"Toggle two page view")]),s("tr",null,[s("td",null,"r"),s("td",null,"Read Right to Left")]),s("tr",null,[s("td",null,"l"),s("td",null,"Read Left to Right")]),s("tr",null,[s("td",null,"t"),s("td",null,"Read Top to Bottom")]),s("tr",null,[s("td",null,"b"),s("td",null,"Read in Bottom to Top")])])],-1)),vo=C(()=>s("h4",null,"Other",-1)),Po=C(()=>s("table",{class:"highlight-table"},[s("tbody",null,[s("tr",null,[s("td",null,"m"),s("td",null,"Show comic's metadata")]),s("tr",null,[s("td",null,"double click"),s("td",null,"Zoom page")])])],-1));function wo(e,t,a,u,i,o){return e.isMobile?S("",!0):(d(),g(it,{key:0},{default:l(()=>[n(st,{id:"readerKeyboardShortcuts"},{default:l(()=>[n(rt,{id:"shortcutsTitle"},{default:l(()=>[n(y,{id:"keyboardIcon"},{default:l(()=>[k(f(i.mdiKeyboardOutline),1)]),_:1}),k("Keyboard Shortcuts ")]),_:1}),n(nt,null,{default:l(()=>[lo,s("table",co,[s("tbody",null,[s("tr",null,[s("td",null,[n(y,{class:"keyIcon",density:"compact"},{default:l(()=>[k(f(i.mdiMenuLeft),1)]),_:1}),k(", j, "),s("div",null,[n(y,{class:"keyIcon",density:"compact"},{default:l(()=>[k(f(i.mdiAppleKeyboardShift),1)]),_:1}),n(y,{class:"keyIcon",density:"compact"},{default:l(()=>[k(f(i.mdiKeyboardSpace),1)]),_:1})])]),uo]),s("tr",null,[s("td",null,[n(y,{class:"keyIcon",density:"compact"},{default:l(()=>[k(f(i.mdiMenuRight),1)]),_:1}),k(", k, "),n(y,{class:"keyIcon",density:"compact"},{default:l(()=>[k(f(i.mdiKeyboardSpace),1)]),_:1})]),ho]),go,po,mo,ko,bo])]),_o,fo,vo,Po]),_:1})]),_:1})]),_:1}))}const So=b(io,[["render",wo],["__scopeId","data-v-a8b4ac47"]]),ke=["fitTo","readingDirection","twoPages"];Object.freeze(ke);const yo={name:"ReaderSettingsPanel",data(){return{isGlobalScope:!1,mdiOpenInNew:Oe}},computed:{...v(D,["isAuthDialogOpen"]),...v(c,["isVertical","isPDF","cacheBook"]),...P(c,{choices:e=>e.choices,validBook:e=>{var t;return!!((t=e.books)!=null&&t.current)},selectedSettings(e){var t,a;return this.isGlobalScope||!((t=e.books)!=null&&t.current)?e.readerSettings:(a=e.books)==null?void 0:a.current.settings},isClearSettingsButtonDisabled(e){var t,a;if(this.isGlobalScope||!((t=e.books)!=null&&t.current))return!0;for(const u of ke){const i=(a=e.books)==null?void 0:a.current.settings[u];if(!e.choices.nullValues.has(i))return!1}return!0},bookInBrowserURL(e){var t,a;return(t=e.books)!=null&&t.current?Ne((a=e.books)==null?void 0:a.current):""}}),...re(c,["readRtlInReverse"]),fitToChoices(){return this.choicesWithoutNull("fitTo")},readingDirectionChoices(){return this.choicesWithoutNull("readingDirection")},disableTwoPages(){return this.isVertical||this.isPDF&&this.cacheBook},disableCacheBook(){return this.isVertical&&this.isPDF}},mounted(){document.addEventListener("keyup",this._keyUpListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyUpListener)},methods:{..._(c,["clearSettingsLocal","setSettingsGlobal","setSettingsLocal","setSettingsClient"]),settingsDialogChanged(e){this.isGlobalScope?this.setSettingsGlobal(e):this.setSettingsLocal(e)},choicesWithoutNull(e){const t=[];for(const a of this.choices[e])a.value&&t.push(a);return Object.freeze(t),t},_keyUpListener(e){if(e.stopPropagation(),this.isAuthDialogOpen)return;let t;switch(e.key){case"w":t={fitTo:"W"};break;case"h":t={fitTo:"H"};break;case"s":t={fitTo:"S"};break;case"o":t={fitTo:"O"};break;case"2":t={twoPages:!this.selectedSettings.twoPages};break;case"l":t={readingDirection:"ltr"};break;case"r":t={readingDirection:"rtl"};break;case"t":t={readingDirection:"ttb"};break;case"b":t={readingDirection:"bbt"};break}t&&this.setSettingsLocal(t)}}},Co={key:0,id:"readerSettings"},Ro=["href"];function Bo(e,t,a,u,i,o){return e.validBook?(d(),w("div",Co,[n(E,{modelValue:i.isGlobalScope,"onUpdate:modelValue":t[0]||(t[0]=r=>i.isGlobalScope=r),density:"compact",label:"Scope","hide-details":"auto"},{default:l(()=>[n(I,{label:"Only this comic",value:!1}),n(I,{label:"Default for all comics",value:!0})]),_:1},8,["modelValue"]),n(E,{class:"displayRadioGroup",density:"compact",label:"Display","hide-details":"auto","model-value":e.selectedSettings.fitTo,"onUpdate:modelValue":t[1]||(t[1]=r=>o.settingsDialogChanged({fitTo:r}))},{default:l(()=>[(d(!0),w(B,null,V(o.fitToChoices,r=>(d(),g(I,{key:r.value,label:r.title,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"]),n(U,{disabled:o.disableTwoPages,class:"displayTwoPages",density:"compact",label:"Two pages","hide-details":"auto","model-value":e.selectedSettings.twoPages,"true-value":!0,indeterminate:e.selectedSettings.twoPages===null||e.selectedSettings.twoPages===void 0,"onUpdate:modelValue":t[2]||(t[2]=r=>o.settingsDialogChanged({twoPages:r}))},null,8,["disabled","model-value","indeterminate"]),n(E,{class:"displayRadioGroup",density:"compact",label:"Reading Direction","hide-details":"auto","model-value":e.selectedSettings.readingDirection,"onUpdate:modelValue":t[3]||(t[3]=r=>o.settingsDialogChanged({readingDirection:r}))},{default:l(()=>[(d(!0),w(B,null,V(o.readingDirectionChoices,r=>(d(),g(I,{key:r.value,label:r.title,value:r.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"]),n(U,{"model-value":e.cacheBook,class:"cacheBook",density:"compact",disabled:o.disableCacheBook,label:"Cache Entire Book","hide-details":"auto","true-value":!0,"onUpdate:modelValue":t[4]||(t[4]=r=>e.setSettingsClient({cacheBook:r}))},null,8,["model-value","disabled"]),e.isPDF?(d(),w("a",{key:0,id:"readPDFInBrowser",href:e.bookInBrowserURL,target:"_blank"},[n(y,null,{default:l(()=>[k(f(i.mdiOpenInNew),1)]),_:1}),k("Read PDF in Browser ")],8,Ro)):S("",!0),i.isGlobalScope?(d(),g(U,{key:1,"model-value":e.selectedSettings.readRtlInReverse,class:"readRtlInReverse",density:"compact",label:"Read RTL Comics as LTR","hide-details":"auto","true-value":!0,"onUpdate:modelValue":t[5]||(t[5]=r=>o.settingsDialogChanged({readRtlInReverse:r}))},null,8,["model-value"])):S("",!0),i.isGlobalScope?S("",!0):(d(),g(ne,{key:2,id:"clearSettingsButton",disabled:e.isClearSettingsButtonDisabled,title:"Use the default settings for all comics for this comic",onClick:e.clearSettingsLocal},{default:l(()=>[k(" Clear Comic Settings ")]),_:1},8,["disabled","onClick"]))])):S("",!0)}const To=b(yo,[["render",Bo],["__scopeId","data-v-599636e1"]]),Do={name:"ReaderSettingsSuperPanel",components:{DownloadPanel:no,ReaderKeyboardShortcutsPanel:So,ReaderSettingsPanel:To}};function Io(e,t,a,u,i,o){const r=h("ReaderSettingsPanel"),p=h("ReaderKeyboardShortcutsPanel"),m=h("DownloadPanel");return d(),w(B,null,[n(r),n(H),n(p),n(H),n(m)],64)}const Lo=b(Do,[["render",Io]]),$o={name:"ReaderSettingsDrawer",components:{SettingsDrawer:Xe,ReaderSettingsSuperPanel:Lo}};function Vo(e,t,a,u,i,o){const r=h("ReaderSettingsSuperPanel"),p=h("SettingsDrawer");return d(),g(p,{title:"Reader",temporary:"","disable-resize-watcher":""},{panel:l(()=>[n(r)]),_:1})}const Oo=b($o,[["render",Vo]]),Q={a:Ee,f:Ue,s:xe},No={a:"Story Arc",f:"Folder",s:"Series"},Ao={name:"ReaderArcSelect",components:{ToolbarSelect:lt},computed:{...P(c,{arcGroup:e=>{var t;return((t=e.arc)==null?void 0:t.group)||"s"},arc:e=>e.arc,arcName:e=>{for(const t of e.arcs)if(e.arc.group===t.group&&e.arc.pks===t.pks)return t.name;return"Unknown"},arcItems:e=>{const t=[];for(const a of e.arcs){const u={value:a,title:a.name,group:a.group,subtitle:No[a.group],prependIcon:Q[a.group]};t.push(u)}return t}})},methods:{..._(c,["loadBooks"]),arcIcon(e){return Q[e]},checkIcon(e){return e===this.arc?Ae:""},onUpdate(e){const t=this.$route.params;if(!t)return;const a={group:e.group,pks:e.pks},u={...t,arc:a};this.loadBooks(u)}}},Eo={id:"arcPos"};function Uo(e,t,a,u,i,o){const r=h("ToolbarSelect");return d(),g(r,{"model-value":e.arc,class:"arcSelect","select-label":"reading order",items:e.arcItems,disabled:!e.arcItems||e.arcItems.length<=1,"onUpdate:modelValue":o.onUpdate},{item:l(({item:p,props:m})=>[n(z,F(m,{density:"compact",variant:"plain","prepend-icon":p.raw.prependIcon,subtitle:p.raw.subtitle,"append-icon":o.checkIcon(m.value)}),null,16,["prepend-icon","subtitle","append-icon"])]),selection:l(({item:p,props:m})=>[n(y,F({size:"large"},m,{class:"arcSelectIcon"}),{default:l(()=>[k(f(o.arcIcon(p.raw.group)),1)]),_:2},1040),s("span",Eo,f(e.arc.index)+" / "+f(e.arc.count),1)]),_:1},8,["model-value","items","disabled","onUpdate:modelValue"])}const xo=b(Ao,[["render",Uo],["__scopeId","data-v-42a57aca"]]),Fo={name:"ReaderTitleToolbar",components:{MetadataDialog:ct,ReaderArcSelect:xo,SettingsDrawerButton:Ze},data(){return{mdiClose:Fe,routeChanged:!1}},head(){return{meta:[{hid:"description",name:"description",content:`reader ${this.activeTitle} page ${this.storePage}`}]}},computed:{...v(D,["isAuthDialogOpen"]),...v(c,["activeTitle","closeBookRoute"]),...P(c,{currentBook:e=>{var t;return((t=e.books)==null?void 0:t.current)||{}},empty:e=>e.empty,subtitle:e=>{var t,a;return((a=(t=e.books)==null?void 0:t.current)==null?void 0:a.name)||""}}),title(){return this.activeTitle},extensionHeight(){let e=32;return this.subtitle&&(e*=2),e}},watch:{$route(e,t){t&&(this.routeChanged=!0)}},mounted(){document.addEventListener("keyup",this._keyUpListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyUpListener)},methods:{..._(M,["setTimestamp"]),..._(c,["routeToDirection","routeToDirectionOne","routeToBook","setBookChangeFlag"]),openMetadata(){this.$refs.metadataDialog.dialog=!0},onCloseBook(){this.routeChanged&&this.setTimestamp()},_keyUpListener(e){if(e.stopPropagation(),!this.isAuthDialogOpen)switch(e.key){case"Escape":this.$refs.closeBook.$el.click();break;case"m":this.empty||this.openMetadata();break}}}},zo={id:"title"},Mo={key:0,id:"subtitle"};function Wo(e,t,a,u,i,o){const r=h("ReaderArcSelect"),p=h("MetadataDialog"),m=h("SettingsDrawerButton");return d(),g(Qe,{id:"readerToolbarTop",density:"compact","extension-height":o.extensionHeight},ze({default:l(()=>[n(x,null,{default:l(()=>[n(ne,{ref:"closeBook",class:"closeBook",to:e.closeBookRoute,size:"large",density:"compact",variant:"plain",onClick:o.onCloseBook},{default:l(()=>[k(" close book ")]),_:1},8,["to","onClick"])]),_:1}),n(dt),e.empty?S("",!0):(d(),g(x,{key:0},{default:l(()=>[n(r),n(p,{ref:"metadataDialog",group:"c",toolbar:!0,book:e.currentBook},null,8,["book"])]),_:1})),n(x,null,{default:l(()=>[n(m)]),_:1})]),_:2},[o.title?{name:"extension",fn:l(()=>[n(Je,{class:"readerTitle"},{default:l(()=>[s("div",zo,f(o.title),1),e.subtitle?(d(),w("div",Mo,f(e.subtitle),1)):S("",!0)]),_:1})]),key:"0"}:void 0]),1032,["extension-height"])}const be=b(Fo,[["render",Wo],["__scopeId","data-v-ca98d9ec"]]),Ho={name:"ReaderEmpty",components:{ReaderTopToolbar:be},data(){return{mdiBookRemoveOutline:Me}}};function qo(e,t,a,u,i,o){const r=h("ReaderTopToolbar");return d(),w(B,null,[n(r),n(le,{class:"empty",headline:"Book Not Found",title:"Close the reader and find another book",icon:i.mdiBookRemoveOutline},null,8,["icon"])],64)}const Go=b(Ho,[["render",qo],["__scopeId","data-v-65d65e48"]]),Ko={name:"ReaderBookChangeNavButton",components:{PaginationNavButton:ue},props:{direction:{type:String,required:!0}},computed:{...v(c,["isBTT"]),...P(c,{toRoute(e){var a;const t=(a=e==null?void 0:e.routes)==null?void 0:a.books[this.direction];return t?{params:{...t}}:""}}),title(){return(this.direction==="prev"?"Previous":"Next")+" Book"},icon(){return this.bookChangeIcon(this.direction)},classes(){return{bookChangeNavButtonLeft:this.direction==="prev",bookChangeNavButtonRight:this.direction==="next"}}},methods:{..._(c,["bookChangeIcon"])}};function jo(e,t,a,u,i,o){const r=h("PaginationNavButton");return e.toRoute?(d(),g(r,{key:0,class:R(o.classes),icon:"",variant:"plain",title:o.title,to:e.toRoute},{default:l(()=>[n(y,null,{default:l(()=>[k(f(o.icon),1)]),_:1})]),_:1},8,["class","title","to"])):S("",!0)}const Yo=b(Ko,[["render",jo],["__scopeId","data-v-117f651c"]]),Xo={name:"ReaderNavButton",components:{PaginationNavButton:ue},props:{value:{type:Number,required:!0},twoPages:{type:Boolean,default:!1}},computed:{...v(c,["isVertical"]),...P(c,{storePage:e=>e.page,toRoute(e){if(!this.isVertical)return{params:{pk:e.books.current.pk,page:this.value}}},isBookPrev:e=>!!e.routes.books.prev,isBookNext:e=>!!e.routes.books.next}),classes(){return{readerNavButtonLeft:!this.isBookPrev&&this.value===0,readerNavButtonRight:!this.isBookNext&&this.value!=0}},title(){return"Page "+this.value},disabled(){return this.value===this.storePage||this.twoPages&&!!(this.value%2)&&this.value-1===this.storePage}},methods:{..._(c,["setActivePage"]),onClick(){this.isVertical&&this.setActivePage(this.value,!0)}}};function Zo(e,t,a,u,i,o){const r=h("PaginationNavButton");return d(),g(r,{key:e.isVertical,disabled:o.disabled,class:R(["readerNavButton",o.classes]),title:o.title,to:e.toRoute,onClick:o.onClick},{default:l(()=>[k(f(a.value),1)]),_:1},8,["disabled","class","title","to","onClick"])}const Jo=b(Xo,[["render",Zo],["__scopeId","data-v-530fba8c"]]),L="prev",$="next",Qo={name:"ReaderNavToolbar",components:{PaginationSlider:ut,ReaderNavButton:Jo,PaginationToolbar:ht,ReaderBookChangeNavButton:Yo},computed:{...v(D,["isAuthDialogOpen"]),...v(c,["activeSettings","isReadInReverse","isVertical"]),...P(c,{storePage:e=>e.page,key(e){var t,a;return`${(a=(t=e.books)==null?void 0:t.current)==null?void 0:a.pk}:${this.step}:${this.isReadInReverse}`},maxPage:e=>{var t,a;return((a=(t=e.books)==null?void 0:t.current)==null?void 0:a.maxPage)||0}}),twoPages(){return this.activeSettings.twoPages},step(){return this.activeSettings.twoPages?2:1},trackColor(){return this.twoPages&&+this.storePage>=this.maxPage-1?this.$vuetify.theme.current.colors.primary:""},min(){return this.isReadInReverse?this.maxPage:0},max(){return this.isReadInReverse?0:this.maxPage},bookPrev(){return this.isReadInReverse?"next":"prev"},bookNext(){return this.isReadInReverse?"prev":"next"}},mounted(){document.addEventListener("keyup",this._keyUpListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyUpListener)},methods:{..._(c,["routeToBook","routeToDirection","routeToDirectionOne","routeToPage","setActivePage"]),onSliderUpdate(e){this.isVertical?this.setActivePage(e,!0):this.routeToPage(e)},_keyUpListener(e){if(e.stopPropagation(),!this.isAuthDialogOpen)switch(e.key){case" ":!e.shiftKey&&window.innerHeight+window.scrollY+1>=document.body.scrollHeight?this.routeToDirection($):e.shiftKey&&window.scrollY===0&&this.routeToDirection(L);break;case"j":case"ArrowRight":this.routeToDirection($);break;case"k":case"ArrowLeft":this.routeToDirection(L);break;case",":this.routeToDirectionOne(L);break;case".":this.routeToDirectionOne($);break;case"n":this.routeToBook($);break;case"p":this.routeToBook(L);break}}}};function ea(e,t,a,u,i,o){const r=h("ReaderBookChangeNavButton"),p=h("ReaderNavButton"),m=h("PaginationSlider"),O=h("PaginationToolbar");return e.maxPage?(d(),g(O,{key:0,id:"readerToolbarNav"},{default:l(()=>[n(r,{direction:o.bookPrev,narrow:!1},null,8,["direction"]),n(p,{value:o.min,"two-pages":o.twoPages},null,8,["value","two-pages"]),(d(),g(m,{key:e.key,"model-value":e.storePage,min:0,max:e.maxPage,step:o.step,"track-color":o.trackColor,reverse:e.isReadInReverse,"onUpdate:modelValue":t[0]||(t[0]=N=>o.onSliderUpdate(N))},null,8,["model-value","max","step","track-color","reverse"])),n(p,{value:o.max,"two-pages":o.twoPages},null,8,["value","two-pages"]),n(r,{direction:o.bookNext,narrow:!1},null,8,["direction"])]),_:1})):S("",!0)}const ta=b(Qo,[["render",ea],["__scopeId","data-v-dab0637e"]]),oa={name:"MainReader",components:{BooksWindow:oo,ReaderEmpty:Go,ReaderNavToolbar:ta,ReaderTopToolbar:be,ReaderSettingsDrawer:Oo,Unauthorized:tt},data(){return{showToolbars:!1}},computed:{...v(D,["isAuthorized"]),...P(D,{user:e=>e.user}),...P(c,{empty:e=>e.empty})},watch:{user(){this.loadReaderSettings()},isAuthorized(){this.loadReaderSettings()}},beforeMount(){c().$reset,this.loadReaderSettings()},methods:{..._(c,["loadReaderSettings"]),toggleToolbars(){this.showToolbars=!this.showToolbars}}},aa={key:0},sa={id:"readerContainer"};function ra(e,t,a,u,i,o){const r=h("ReaderTopToolbar"),p=h("BooksWindow"),m=h("ReaderNavToolbar"),O=h("ReaderEmpty"),N=h("ReaderSettingsDrawer"),_e=h("Unauthorized");return e.isAuthorized?(d(),g(ot,{key:0,id:"readerWrapper"},{default:l(()=>[e.empty?(d(),g(O,{key:1})):(d(),w("div",aa,[s("div",sa,[n(We,null,{default:l(()=>[T(n(r,null,null,512),[[q,i.showToolbars]])]),_:1}),n(p,{onClick:o.toggleToolbars},null,8,["onClick"]),n(He,null,{default:l(()=>[T(n(m,null,null,512),[[q,i.showToolbars]])]),_:1})])])),n(N)]),_:1})):(d(),g(_e,{key:1}))}const ya=b(oa,[["render",ra],["__scopeId","data-v-dab9a44d"]]);export{ya as default};
